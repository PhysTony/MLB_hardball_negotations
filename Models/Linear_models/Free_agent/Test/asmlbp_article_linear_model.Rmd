---
title: "Cambio estructural"
author: "Antonio Huerta Montellano"
date: "7 de agosto del 2022"
output:
  pdf_document: 
    fig_caption: yes
    latex_engine: xelatex
    keep_tex: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Importando las librerías:
```{r message=FALSE, warning=FALSE, include=FALSE}
library(wooldridge)
library(tidyverse)
library(knitr)
library(readxl)
library(dplyr)
library(ggplot2)
library(coefplot)
library(data.table)
library(pacman)
library(tinytex)
library(AER)
library(car)
library(cragg)
library(tidyr)
options(scipen = 999)
library(tidyverse)
library(stargazer)
library(readxl)
library(dplyr)
library(tidyr)
library(haven)
library(lmtest)
library(sandwich)
library(gap)
library(quantmod)
```

\section{Bases de datos}

Veamos cuál es el directorio de trabajo
```{r setwd}
getwd()
```

Cambiemos el directorio de trabajo y carguemos las bases de datos para el modelo lineal en el mismo chunk:

```{r base_datos}
setwd("~/Documentos/Github/Proyectos/MLB_HN/")
catchers_panel_data <- read.csv('Data/New_Data/Models/Article/article_catchers_panel_data.csv')
relief_pitchers_panel_data <- read.csv('Data/New_Data/Models/Article/article_relief_pitchers_panel_data.csv')
starting_pitchers_panel_data <- read.csv('Data/New_Data/Models/Article/article_starting_pitchers_panel_data.csv')
remain_hitters_panel_data <- read.csv('Data/New_Data/Models/Article/article_remain_hitters_panel_data.csv')
```
Observemos el contenido de las bases de datos de los catchers:
```{r catchers_datos_head}
head(catchers_panel_data)
```

Ahora de los que son relief pitchers:
```{r relief_pitchers_datos_head}
head(relief_pitchers_panel_data)
```

Starting pitchers:
```{r starting_pitchers_datos_head}
head(starting_pitchers_panel_data)
```

Remain hitters:
```{r remain_hitters_datos_head}
head(remain_hitters_panel_data)
```


\section{Creación del modelo}

Para ello y evitar errores, lo haremos con los nombres explícitos, obtengamos los nombres de las columnas
```{r catchers_names}
colnames(catchers_panel_data)
```

```{r relief_pitchers_names}
colnames(relief_pitchers_panel_data)
```

```{r starting_pitchers_names}
colnames(starting_pitchers_panel_data)
```

```{r remain_hitters_names}
colnames(remain_hitters_panel_data)
```

Creemos ahora las formulas para las regresiones lineales sobre $ln(Salario_{t})$ donde solo se considerarán las variables que presenten una correlación mayor o igual al $50\%$ y en algunos casos, solo con que sean mayores o iguales a $45\%$.

\subsection{Catchers}

En este caso, consideramos las variables que tuvieron un coeficiente de correlación mayor al $50\%$ y después de obtener la primera versión del mdoelo, solo se dejaron las variables que son estadísitcamente significativas en otro modelo.

```{r catchers_corr_model}
catcher_corr_model <- lm(ln_Sueldo_t ~ Anio_t + Anios_contrato_t + Home_runs_t + 
                                  Home_runs_t_1 + Home_runs_2_t_1 + OPS_2_t_1,
                                  data = catchers_panel_data)
summary(catcher_corr_model, diagnostics=TRUE)
```

Ahora, se obtendrá el modelo que contiene solo las variables más significativas y que no estuvieran correlacionadas para este

```{r catchers_sig_model}
catcher_sig_model <- lm(ln_Sueldo_t ~ Anio_t + Anios_contrato_t + Home_runs_t + OPS_t + 
                                      Home_runs_t_1 + Home_runs_2_t_1 + OPS_2_t_1,
                                      data = catchers_panel_data)
summary(catcher_sig_model, diagnostics=TRUE)
```

\subsection{Remain hitters}

Se siguió un proceso análogo, primero se dará el modelo con las variables que estén correlacionadas con $45\%$ o más con $ln(Sueldo_{t})$

```{r remain_hitters_corr_model}
remain_hitter_corr_model <- lm(ln_Sueldo_t ~ Anios_contrato_t + RBI_t_1,
                                      data = remain_hitters_panel_data)
summary(remain_hitter_corr_model, diagnostics=TRUE)
```

Luego, obtenemos el modelo que solo contenga las variables estadísticamente significativas

```{r remain_hitters_sig_model}
remain_hitter_sig_model <- lm(ln_Sueldo_t ~ Anio_t + Anios_contrato_t + Home_runs_t +
                                      Home_runs_t_1 + Home_runs_2_t_1,
                                      data = remain_hitters_panel_data)
summary(remain_hitter_sig_model, diagnostics=TRUE)
```
\subsection{Starting pitchers}

Se hará totalmente análogo, el modelo por la matriz de correlación para un umbral del $45\%$ es el siguiente
```{r starting_pitchers_corr_regression}
starting_pitchers_corr_model <- lm(ln_Sueldo_t ~ Anios_contrato_t + Inning_pitched_2_t + Inning_pitched_t_1, 
                                                 data = starting_pitchers_panel_data)
summary(starting_pitchers_corr_model, diagnostics=TRUE)
```
Por otro lado, el modelo con las variables estadísticamente significativas se muestra a continuación:
```{r starting_pitchers_sig_regression}
starting_pitchers_sig_model <- lm(ln_Sueldo_t ~ Anio_t + Anios_contrato_t + Inning_pitched_t_1 + 
                                                Dominio_t + Control_t + Comando_t + Juegos_t_1 + 
                                                Juegos_iniciados_t_1 + Saves_2_t_1, 
                                                data = starting_pitchers_panel_data)
summary(starting_pitchers_sig_model, diagnostics=TRUE)
```


\subsection{Relief pitchers}

De igual manera, el modelo por la matriz de correlación para un umbral del $30\%$ es el siguiente
```{r relief_pitchers_corr_regression}
relief_pitchers_corr_model <- lm(ln_Sueldo_t ~ Anios_contrato_t + Losses_t + WHIP_2_t_1, 
                                               data = relief_pitchers_panel_data)
summary(relief_pitchers_corr_model, diagnostics=TRUE)
```

Por último, el modelo con las variables estadísticamente significativas
```{r relief_pitchers_sig_regression}
relief_pitchers_sig_model <- lm(ln_Sueldo_t ~ Anios_contrato_t + Dominio_t + 
                                              Losses_t + WHIP_2_t_1, 
                                              data = relief_pitchers_panel_data)
summary(relief_pitchers_sig_model, diagnostics=TRUE)
```