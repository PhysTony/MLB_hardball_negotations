---
title: "Dynamic Model - Structural Changes"
author: "Antonio Huerta Montellano"
date: "\today"
output:
  pdf_document: default
---

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = TRUE)
opts_chunk$set(comment = NA)
options(warn = FALSE) # ignore warnings
```

```{r libraries, include=FALSE}
library(lmtest) # for robust standard errors
library(dplyr) # for group_by function
library(ggplot2) # for better plots
library(dplyr) # for data managment
library(clubSandwich) # Grouped errors
library(sandwich) # MOre error options
library(tidyr) # Datframes manipulation
library(stargazer) # For output formats
library(lubridate)
library(plm)
```

```{r import_panel, include = FALSE, warning = FALSE}
setwd("~/Documentos/Github/Proyectos/MLB_HN/")
hitters_panel <- read.csv('ETL_Data/Panel/General/Dynamic_model/dynamic_model_hitter_pca.csv')
fielders_panel <- read.csv('ETL_Data/Panel/General/Dynamic_model/dynamic_model_fielder_pca.csv')
```

```{r position_dummyfication, include=FALSE}
# Convert categorical column to numerical
# Position;
hitters_panel$position_num_t <- as.numeric(factor(hitters_panel$Posicion_t))
fielders_panel$position_num_t <- as.numeric(factor(fielders_panel$Posicion_t))
# Team:
hitters_panel$team_num_t <- as.numeric(factor(hitters_panel$Acronimo_t))
fielders_panel$team_num_t <- as.numeric(factor(fielders_panel$Acronimo_t))
# Free Agent dummy
hitters_panel <- cbind(setNames(data.frame(rep(1, nrow(hitters_panel))), "Agente_t"), hitters_panel)
fielders_panel <- cbind(setNames(data.frame(rep(1, nrow(fielders_panel))), "Agente_t"), fielders_panel)
```

```{r fa_dummy, include=FALSE}
# add a column of 1s to the panel data
hitters_panel <- cbind(hitters_panel,
                       fa = rep(1, nrow(hitters_panel)))
fielders_panel <- cbind(fielders_panel,
                        fa = rep(1, nrow(fielders_panel)))
```

```{r covid_filter, include=FALSE}
# filter out rows with year 2020
# Bateadores
hitters_panel_covid <- hitters_panel %>% 
                       filter(Anio_t != 2020)
# Fildeadores
fielders_panel_covid <- fielders_panel %>%
                        filter(Anio_t != 2020)
```

```{r positions_count_hitter, include=FALSE}
hitters_panel %>% count(Posicion_t, sort = TRUE)
```

```{r positions_count_fielder, include=FALSE}
fielders_panel %>% count(Posicion_t, sort = TRUE)
```

```{r position_split, include=FALSE}
# split the data frame by category
split_hitter <- split(hitters_panel,
                      f = hitters_panel$Posicion_t)
split_fielder <- split(fielders_panel,
                       f = fielders_panel$Posicion_t)

# COVID panels:
split_hitter_covid <- split(hitters_panel_covid,
                            f = hitters_panel_covid$Posicion_t)
split_fielder_covid <- split(fielders_panel_covid,
                             f = fielders_panel_covid$Posicion_t)
```

```{r group_category_split, include=FALSE}
# Whole panel:
# Offensive:
h_category_1 <- split_hitter[["SP"]]
h_category_2 <- split_hitter[["RP"]]
h_category_3 <- split_hitter[["RP/CL"]]
h_category_4 <- split_hitter[["C"]]
h_category_5 <- split_hitter[["1B"]]
h_category_6 <- split_hitter[["2B"]]
h_category_7 <- split_hitter[["3B"]]
h_category_8 <- split_hitter[["SS"]]
h_category_9 <- split_hitter[["RF"]]
h_category_10 <- split_hitter[["CF"]]
h_category_11 <- split_hitter[["LF"]]
d_hitter_data <- split_hitter[["DH"]]

# Defensive:
starting_data <- split_fielder[["SP"]]
b_category_2 <- split_fielder[["RP"]]
b_category_3 <- split_fielder[["RP/CL"]]
shorts_data <- split_fielder[["SS"]]

# COVID panel:
# Offensive:
cov_h_category_1 <- split_hitter_covid[["SP"]]
cov_h_category_2 <- split_hitter_covid[["RP"]]
cov_h_category_3 <- split_hitter_covid[["RP/CL"]]
cov_h_category_4 <- split_hitter_covid[["C"]]
cov_h_category_5 <- split_hitter_covid[["1B"]]
cov_h_category_6 <- split_hitter_covid[["2B"]]
cov_h_category_7 <- split_hitter_covid[["3B"]]
cov_h_category_8 <- split_hitter_covid[["SS"]]
cov_h_category_9 <- split_hitter_covid[["RF"]]
cov_h_category_10 <- split_hitter_covid[["CF"]]
cov_h_category_11 <- split_hitter_covid[["LF"]]
d_hitter_cov_data <- split_hitter_covid[["DH"]]

# Defensive:
starting_cov_data <- split_fielder_covid[["SP"]]
cov_b_category_2 <- split_fielder_covid[["RP"]]
cov_b_category_3 <- split_fielder_covid[["RP/CL"]]
shorts_cov_data <- split_fielder_covid[["SS"]]
```

```{r group_concat, include=FALSE}
# All panels:
# Hitters:
# Concatenate the two categories
hitter_data <- rbind(h_category_1, h_category_2, h_category_3, h_category_4,
                     h_category_5, h_category_6, h_category_7, h_category_8,
                     h_category_9, h_category_10, h_category_11)
hitter_data <- unique(hitter_data)

# Fielders:
# Concatenate the two categories
relief_pitcher_data <- rbind(b_category_2, b_category_3)
relief_pitcher_data <- unique(relief_pitcher_data)

# COVID filter:
# Hitters:
# Concatenate the two categories
hitter_cov_data <- rbind(cov_h_category_1, cov_h_category_2, cov_h_category_3, cov_h_category_4,
                         cov_h_category_5, cov_h_category_6, cov_h_category_7, cov_h_category_8,
                         cov_h_category_9, cov_h_category_10, cov_h_category_11)
hitter_cov_data <- unique(hitter_cov_data)

# Fielders:
# Concatenate the two categories
relief_pitcher_cov_data <- rbind(cov_b_category_2, cov_b_category_3)
relief_pitcher_cov_data <- unique(relief_pitcher_cov_data)
```

```{r hitter_var_list, include=FALSE}
# LIsta de variables acumuladas y anualmente promediadas_
stat_hitter <- list("X_At_bats", "X_At_bats_2",
                    "X_Bateos", "X_Bateos_2",
                    "X_Bateos_promedio", "X_Bateos_promedio_2", 
                    "X_Dobles", "X_Dobles_2",
                    "X_Home_runs", "X_Home_runs_2",
                    "X_Juegos_iniciados", "X_Juegos_iniciados_2",
                    "X_Porcentaje_On_base_plus_slugging", "X_Porcentaje_On_base_plus_slugging_2",
                    "X_Porcentaje_on_base", "X_Porcentaje_on_base_2",
                    "X_Porcentaje_slugging", "X_Porcentaje_slugging_2",
                    "X_Runs_batted_in", "X_Runs_batted_in_2",
                    "X_Triples", "X_Triples_2",
                    "X_WAR", "X_WAR_2")

# Add suffix "_t" to each name
stat_hitter_t <- paste0(stat_hitter, "_t")
stat_hitter_t_1 <- paste0(stat_hitter, "_t_1")
```

```{r fielder_var_list, include = FALSE}
# LIsta de variables acumuladas y anualmente promediadas_
stat_fielder <- list('X_Bateos_2', 'X_Bateos',
                     'X_Carreras_2', 'X_Carreras_ganadas_2',
                     'X_Carreras_ganadas', 'X_Carreras',
                     'X_Comando_2', 'X_Comando',
                     'X_Control_2', 'X_Control',
                     'X_Dominio_2', 'X_Dominio',
                     'X_ERA_2', 'X_ERA',
                     'X_Inning_pitched_2', 'X_Inning_pitched',
                     'X_Losses_2', 'X_Losses',
                     'X_Saves_2', 'X_Saves',
                     'X_Strike_outs_2', 'X_Strike_outs',
                     'X_WAR_2', 'X_WAR',
                     'X_WHIP_2', 'X_WHIP',
                     'X_Walks_2', 'X_Walks',
                     'X_Wins_2', 'X_Wins')

# Add suffix "_t" to each name
stat_fielder_t <- paste0(stat_fielder, "_t")
stat_fielder_t_1 <- paste0(stat_fielder, "_t_1")
```

```{r controles, include=FALSE}
# Constroles:
vars_ms  <- 'Y_Sueldo_regular_norm_t ~ Edad_t + Anios_de_contrato_t + team_num_t'
# Constroles:
vars_fe  <- 'Y_Sueldo_regular_norm_t ~ Edad_t + Anios_de_contrato_t + team_num_t -1'
```

```{r hitter_stats_labels, include=FALSE}
hitter_stats_1 = c("Edad$_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                   "$X_{AB_{t}}$","$X_{AB_{t-1}}$","$X_{AB^{2}_{t}}$","$X_{AB^{2}_{t-1}}$",
                   "$X_{H_{t}}$","$X_{H_{t-1}}$","$X_{H^{2}_{t}}$","$X_{H^{2}_{t-1}}$",
                   "$X_{BA_{t}}$","$X_{BA_{t-1}}$", "$X_{BA^{2}_{t}}$","$X_{BA^{2}_{t-1}}$",
                   "Agente$_{t}$")
hitter_stats_2 = c("Edad$_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                   "$X_{D_{t}}$","$X_{D_{t-1}}$","$X_{D^{2}_{t}}$","$X_{D^{2}_{t-1}}$",
                   "$X_{HR_{t}}$","$X_{HR_{t-1}}$","$X_{HR^{2}_{t}}$","$X_{HR^{2}_{t-1}}$",
                   "$X_{GS_{t}}$","$X_{GS_{t-1}}$", "$X_{GS^{2}_{t}}$","$X_{GS^{2}_{t-1}}$",
                   "Agente$_{t}$")
hitter_stats_3 = c("Edad$_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                   "$X_{OPS_{t}}$","$X_{OPS_{t-1}}$","$X_{OPS^{2}_{t}}$","$X_{OPS^{2}_{t-1}}$",
                   "$X_{OBP_{t}}$","$X_{OBP_{t-1}}$","$X_{OBP^{2}_{t}}$","$X_{OBP^{2}_{t-1}}$",
                   "$X_{SLG_{t}}$","$X_{SLG_{t-1}}$", "$X_{SLG^{2}_{t}}$","$X_{SLG^{2}_{t-1}}$",
                   "Agente$_{t}$")
hitter_stats_4 = c("Edad$_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                   "$X_{RBI_{t}}$","$X_{RBI_{t-1}}$","$X_{RBI^{2}_{t}}$","$X_{RBI^{2}_{t-1}}$",
                   "$X_{T_{t}}$","$X_{T_{t-1}}$","$X_{T^{2}_{t}}$","$X_{T^{2}_{t-1}}$",
                   "$X_{WAR_{t}}$","$X_{WAR_{t-1}}$", "$X_{WAR^{2}_{t}}$","$X_{WAR^{2}_{t-1}}$",
                   "Agente$_{t}$")
hitter_stats <- list(hitter_stats_1,
                     hitter_stats_2,
                     hitter_stats_3,
                     hitter_stats_4)

# Cycles for loop
hitter_rep <- 4
# Stats to show
hitter_stat_num <- 6
```

```{r hitter_list_var_long, include=FALSE}
hitter_stats_long <- list(c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$", 
                            "$X_{AB_{t}}$","$X_{AB_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$", 
                            "$X_{AB^{2}_{t}}$","$X_{AB^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{H_{t}}$","$X_{H_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{H^{2}_{t}}$","$X_{H^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{BA_{t}}$","$X_{BA_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{BA^{2}_{t}}$","$X_{BA^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{D_{t}}$","$X_{D_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{D^{2}_{t}}$","$X_{D^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{HR_{t}}$","$X_{HR_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{HR^{2}_{t}}$","$X_{HR^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{GS_{t}}$","$X_{GS_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{GS^{2}_{t}}$","$X_{GS^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{OPS_{t}}$","$X_{OPS_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{OPS^{2}_{t}}$","$X_{OPS^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{OBP_{t}}$","$X_{OBP_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{OBP^{2}_{t}}$","$X_{OBP^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{SLG_{t}}$","$X_{SLG_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{SLG^{2}_{t}}$","$X_{SLG^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{RBI_{t}}$","$X_{RBI_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{RBI^{2}_{t}}$","$X_{RBI^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{T_{t}}$","$X_{T_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{T^{2}_{t}}$","$X_{T^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{WAR_{t}}$","$X_{WAR_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}$","Años contrato$_{t}$",
                            "Eqipo$_{t}$",
                            "$X_{WAR^{2}_{t}}$","$X_{WAR^{2}_{t-1}}$",
                            "Agente$_{t}$")
                          )
```


```{r fielder_stats_labels, include=FALSE}
fielder_stats_1 = c("Edad$_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                    "$X_{H^{2}_{t}}$","$X_{H^{2}_{t-1}}$","$X_{H_{t}}$","$X_{H_{t-1}}$",
                    "$X_{R^{2}_{t}}$","$X_{R^{2}_{t-1}}$","$X_{ER^{2}_{t}}$","$X_{ER^{2}_{t-1}}$",
                    "$X_{ER_{t}}$","$X_{ER_{t-1}}$", "$X_{R_{t}}$","$X_{R_{t-1}}$",
                    "Agente$_{t}$")
fielder_stats_2 = c("Edad$_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                    "$X_{Comando^{2}_{t}}$","$X_{Comando^{2}_{t-1}}$","$X_{Comando_{t}}$","$X_{Comando_{t-1}}$",
                    "$X_{Control^{2}_{t}}$","$X_{Control^{2}_{t-1}}$","$Control_{H_{t}}$","$X_{Control_{t-1}}$",
                    "$X_{Dominio^{2}_{t}}$","$X_{Dominio^{2}_{t-1}}$","$X_{Dominio_{t}}$","$X_{Dominio_{t-1}}$",
                    "Agente$_{t}$")
fielder_stats_3 = c("Edad$_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$",
                    "$X_{ERA^{2}_{t}}$","$X_{ERA^{2}_{t-1}}$","$X_{ERA_{t}}$","$X_{ERA_{t-1}}$",
                    "$X_{IP^{2}_{t}}$","$X_{IP^{2}_{t-1}}$","$X_{IP_{t}}$","$X_{IP_{t-1}}$",
                    "$X_{L^{2}_{t}}$","$X_{L^{2}_{t-1}}$", "$X_{L_{t}}$","$X_{L_{t-1}}$",
                    "Agente$_{t}$")
fielder_stats_4 = c("$Edad_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$",
                    "$X_{S^{2}_{t}}$","$X_{S^{2}_{t-1}}$","$X_{S_{t}}$","$X_{S_{t-1}}$",
                    "$X_{SO^{2}_{t}}$","$X_{SO^{2}_{t-1}}$","$X_{SO_{t}}$","$X_{SO_{t-1}}$",
                    "$X_{WAR^{2}_{t}}$","$X_{WAR^{2}_{t-1}}$","$X_{WAR_{t}}$","$X_{WAR_{t-1}}$",
                    "Agente$_{t}$")
fielder_stats_5 = c("Edad$_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$",
                    "$X_{WHIP^{2}_{t}}$","$X_{WHIP^{2}_{t-1}}$","$X_{WHIP_{t}}$","$X_{WHIP_{t-1}}$",
                    "$X_{BB^{2}_{t}}$","$X_{BB^{2}_{t-1}}$","$X_{BB_{t}}$","$X_{BB_{t-1}}$",
                    "$X_{W^{2}_{t}}$","$X_{W^{2}_{t-1}}$","$X_{W_{t}}$","$X_{W_{t-1}}$",
                    "Agente$_{t}$")
fielder_stats <- list(fielder_stats_1,
                      fielder_stats_2,
                      fielder_stats_3,
                      fielder_stats_4,
                      fielder_stats_5)
# Cycles for loop
fielder_rep <- 5
# Stats to show
fielder_stat_num <- 6
```

```{r fielder_list_var_long, include=FALSE}
fielder_stats_long <- list(c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$", 
                              "$X_{H^{2}_{t}}$","$X_{H^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$", 
                              "$X_{H_{t}}$","$X_{H_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{R^{2}_{t}}$","$X_{R^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{ER^{2}_{t}}$","$X_{ER^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{ER_{t}}$","$X_{ER_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{R_{t}}$","$X_{R_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{Comando^{2}_{t}}$","$X_{Comando^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{Comando_{t}}$","$X_{Comando_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{Control^{2}_{t}}$","$X_{Control^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{Control_{t}}$","$X_{Control_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{Dominio^{2}_{t}}$","$X_{Dominio^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{Dominio_{t}}$","$X_{Dominio_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{ERA^{2}_{t}}$","$X_{ERA^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{ERA_{t}}$","$X_{ERA_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{IP^{2}_{t}}$","$X_{IP^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{IP_{t}}$","$X_{IP_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{L^{2}_{t}}$","$X_{L^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{DL_{t}}$","$X_{L_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{S^{2}_{t}}$","$X_{S^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{S_{t}}$","$X_{S_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{SO^{2}_{t}}$","$X_{SO^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{SO_{t}}$","$X_{SO_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{WAR^{2}_{t}}$","$X_{WAR^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{WAR_{t}}$","$X_{WAR_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{WHIP^{2}_{t}}$","$X_{WHIP^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{WHIP_{t}}$","$X_{WHIP_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{BB^{2}_{t}}$","$X_{BB^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{BB_{t}}$","$X_{BB_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{W^{2}_{t}}$","$X_{W^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}$","Años contrato$_{t}$",
                              "Eqipo$_{t}$",
                              "$X_{W_{t}}$","$X_{W_{t-1}}$",
                              "Agente$_{t}$")
                            )
```

```{r hitter_stimation_simple_pooling, include=FALSE}
# Create a model to store the results
hitter_simple_pooling <- list()

# To store the results
hitter_results_simple_pooling_1 <- list()
hitter_results_simple_pooling_2 <- list()
hitter_results_simple_pooling_3 <- list()
hitter_results_simple_pooling_4 <- list()
hitter_results_simple_pooling <- list(result_1 = hitter_results_simple_pooling_1,
                                      result_2 = hitter_results_simple_pooling_2,
                                      result_3 = hitter_results_simple_pooling_3,
                                      result_4 = hitter_results_simple_pooling_4)

# Loop over the variables in var_hitter_list
for (j in 1:hitter_rep){
  
  for (i in 1:hitter_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(vars_ms, stat_hitter_t[[i + hitter_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_hitter_t_1[[i + hitter_stat_num*(j - 1)]],
                     sep = " + ")
    
    hitter_simple_pooling[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = hitter_data,
                                                  model = "pooling",
                                                  index = c("id", "Anio_ref"))
        
    hitter_results_simple_pooling[[j]][[i]] <- coeftest(hitter_simple_pooling[[i + hitter_stat_num*(j - 1)]],
                                                        vcov = vcovHC(hitter_simple_pooling[[i + hitter_stat_num*(j - 1)]],
                                                                      type = "HC1",
                                                                      cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(hitter_results_simple_pooling[[j]],
          no.space = TRUE,
          type = "text",
          title = "Bateadores: Modelo Pooling",
          covariate.labels = hitter_stats[[j]])
}
```

```{r starting_stimation_pooling, include=FALSE}
# Create a model to store the results
fielder_simple_pooling <- list()

# To store the results
fielder_results_simple_pooling_1 <- list()
fielder_results_simple_pooling_2 <- list()
fielder_results_simple_pooling_3 <- list()
fielder_results_simple_pooling_4 <- list()
fielder_results_simple_pooling_5 <- list()
fielder_results_simple_pooling <- list(result_1 = fielder_results_simple_pooling_1,
                                       result_2 = fielder_results_simple_pooling_2,
                                       result_3 = fielder_results_simple_pooling_3,
                                       result_4 = fielder_results_simple_pooling_4,
                                       result_5 = fielder_results_simple_pooling_5)

# Loop over the variables in var_hitter_list
for (j in 1:fielder_rep){
  
  for (i in 1:fielder_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(vars_ms, stat_fielder_t[[i + fielder_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_fielder_t_1[[i + fielder_stat_num*(j - 1)]],
                     sep = " + ")
    
    fielder_simple_pooling[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = starting_data,
                                                  model = "pooling",
                                                  index = c("id", "Anio_ref"))
        
    fielder_results_simple_pooling[[j]][[i]] <- coeftest(fielder_simple_pooling[[i + fielder_stat_num*(j - 1)]],
                                                         vcov = vcovHC(fielder_simple_pooling[[i + fielder_stat_num*(j - 1)]],
                                                                       type = "HC1",
                                                                       cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(fielder_results_simple_pooling[[j]],
          no.space = TRUE,
          type = "text",
          title = "Lanzadores Iniciales: Modelo Pooling",
          covariate.labels = fielder_stats[[j]])
}
```

```{r hitter_stimation_simple_within, include=FALSE}
# Create a model to store the results
hitter_simple_within <- list()

# To store the results
hitter_results_simple_within_1 <- list()
hitter_results_simple_within_2 <- list()
hitter_results_simple_within_3 <- list()
hitter_results_simple_within_4 <- list()
hitter_results_simple_within <- list(result_1 = hitter_results_simple_within_1,
                                      result_2 = hitter_results_simple_within_2,
                                      result_3 = hitter_results_simple_within_3,
                                      result_4 = hitter_results_simple_within_4)

# Loop over the variables in var_hitter_list
for (j in 1:hitter_rep){
  
  for (i in 1:hitter_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(vars_fe, stat_hitter_t[[i + hitter_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_hitter_t_1[[i + hitter_stat_num*(j - 1)]],
                     sep = " + ")
    
    hitter_simple_within[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = hitter_data,
                                                  model = "within",
                                                  index = c("id", "Anio_ref"))
        
    hitter_results_simple_within[[j]][[i]] <- coeftest(hitter_simple_within[[i + hitter_stat_num*(j - 1)]],
                                                        vcov = vcovHC(hitter_simple_within[[i + hitter_stat_num*(j - 1)]],
                                                                      type = "HC1",
                                                                      cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(hitter_results_simple_within[[j]],
          no.space = TRUE,
          type = "text",
          title = "Bateadores: Estimador Within",
          covariate.labels = hitter_stats[[j]])
}
```

### Starting pitcher

```{r starting_stimation_within, include=FALSE}
# Create a model to store the results
fielder_simple_within <- list()

# To store the results
fielder_results_simple_within_1 <- list()
fielder_results_simple_within_2 <- list()
fielder_results_simple_within_3 <- list()
fielder_results_simple_within_4 <- list()
fielder_results_simple_within_5 <- list()
fielder_results_simple_within <- list(result_1 = fielder_results_simple_within_1,
                                       result_2 = fielder_results_simple_within_2,
                                       result_3 = fielder_results_simple_within_3,
                                       result_4 = fielder_results_simple_within_4,
                                       result_5 = fielder_results_simple_within_5)

# Loop over the variables in var_hitter_list
for (j in 1:fielder_rep){
  
  for (i in 1:fielder_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(vars_fe, stat_fielder_t[[i + fielder_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_fielder_t_1[[i + fielder_stat_num*(j - 1)]],
                     sep = " + ")
    
    fielder_simple_within[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = starting_data,
                                                  model = "within",
                                                  index = c("id", "Anio_ref"))
        
    fielder_results_simple_within[[j]][[i]] <- coeftest(fielder_simple_within[[i + fielder_stat_num*(j - 1)]],
                                                         vcov = vcovHC(fielder_simple_within[[i + fielder_stat_num*(j - 1)]],
                                                                       type = "HC1",
                                                                       cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(fielder_results_simple_within[[j]],
          no.space = TRUE,
          type = "text",
          title = "Lanzadores Iniciales: Estimador Within",
          covariate.labels = fielder_stats[[j]])
}
```

```{r hitter_stimation_simple_random, include=FALSE}
# Create a model to store the results
hitter_simple_random <- list()

# To store the results
hitter_results_simple_random_1 <- list()
hitter_results_simple_random_2 <- list()
hitter_results_simple_random_3 <- list()
hitter_results_simple_random_4 <- list()
hitter_results_simple_random <- list(result_1 = hitter_results_simple_random_1,
                                      result_2 = hitter_results_simple_random_2,
                                      result_3 = hitter_results_simple_random_3,
                                      result_4 = hitter_results_simple_random_4)

# Loop over the variables in var_hitter_list
for (j in 1:hitter_rep){
  
  for (i in 1:hitter_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(vars_ms, stat_hitter_t[[i + hitter_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_hitter_t_1[[i + hitter_stat_num*(j - 1)]],
                     sep = " + ")
    
    hitter_simple_random[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = hitter_data,
                                                  model = "random",
                                                  index = c("id", "Anio_ref"))
        
    hitter_results_simple_random[[j]][[i]] <- coeftest(hitter_simple_random[[i + hitter_stat_num*(j - 1)]],
                                                        vcov = vcovHC(hitter_simple_random[[i + hitter_stat_num*(j - 1)]],
                                                                      type = "HC1",
                                                                      cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(hitter_results_simple_random[[j]],
          no.space = TRUE,
          type = "text",
          title = "Bateadores: Efectos Aleatorios",
          covariate.labels = hitter_stats[[j]])
}
```

```{r starting_stimation_random, include=FALSE}
# Create a model to store the results
fielder_simple_random <- list()

# To store the results
fielder_results_simple_random_1 <- list()
fielder_results_simple_random_2 <- list()
fielder_results_simple_random_3 <- list()
fielder_results_simple_random_4 <- list()
fielder_results_simple_random_5 <- list()
fielder_results_simple_random <- list(result_1 = fielder_results_simple_random_1,
                                       result_2 = fielder_results_simple_random_2,
                                       result_3 = fielder_results_simple_random_3,
                                       result_4 = fielder_results_simple_random_4,
                                       result_5 = fielder_results_simple_random_5)

# Loop over the variables in var_hitter_list
for (j in 1:fielder_rep){
  
  for (i in 1:fielder_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(vars_ms, stat_fielder_t[[i + fielder_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_fielder_t_1[[i + fielder_stat_num*(j - 1)]],
                     sep = " + ")
    
    fielder_simple_random[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = starting_data,
                                                  model = "random",
                                                  index = c("id", "Anio_ref"))
        
    fielder_results_simple_random[[j]][[i]] <- coeftest(fielder_simple_random[[i + fielder_stat_num*(j - 1)]],
                                                         vcov = vcovHC(fielder_simple_random[[i + fielder_stat_num*(j - 1)]],
                                                                       type = "HC1",
                                                                       cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(fielder_results_simple_random[[j]],
          no.space = TRUE,
          type = "text",
          title = "Lanzadores Iniciales: Efectos Aleatorios",
          covariate.labels = fielder_stats[[j]])
}
```

```{r hitter_stimation_simple_fd, include=FALSE}
# Create a model to store the results
hitter_simple_fd <- list()

# To store the results
hitter_results_simple_fd_1 <- list()
hitter_results_simple_fd_2 <- list()
hitter_results_simple_fd_3 <- list()
hitter_results_simple_fd_4 <- list()
hitter_results_simple_fd <- list(result_1 = hitter_results_simple_fd_1,
                                 result_2 = hitter_results_simple_fd_2,
                                 result_3 = hitter_results_simple_fd_3,
                                 result_4 = hitter_results_simple_fd_4)

# Loop over the variables in var_hitter_list
for (j in 1:hitter_rep){
  
  for (i in 1:hitter_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(vars_fe, stat_hitter_t[[i + hitter_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_hitter_t_1[[i + hitter_stat_num*(j - 1)]],
                     sep = " + ")
    
    hitter_simple_fd[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = hitter_data,
                                                  model = "fd",
                                                  index = c("id", "Anio_ref"))
        
    hitter_results_simple_fd[[j]][[i]] <- coeftest(hitter_simple_fd[[i + hitter_stat_num*(j - 1)]],
                                                       vcov = vcovHC(hitter_simple_fd[[i + hitter_stat_num*(j - 1)]],
                                                                     type = "HC1",
                                                                     cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(hitter_results_simple_fd[[j]],
          no.space = TRUE,
          type = "text",
          title = "Bateadores: Primeras Diferencias",
          covariate.labels = hitter_stats[[j]])
}
```

```{r starting_stimation_fd, include=FALSE}
# Create a model to store the results
fielder_simple_fd <- list()

# To store the results
fielder_results_simple_fd_1 <- list()
fielder_results_simple_fd_2 <- list()
fielder_results_simple_fd_3 <- list()
fielder_results_simple_fd_4 <- list()
fielder_results_simple_fd_5 <- list()
fielder_results_simple_fd <- list(result_1 = fielder_results_simple_fd_1,
                                       result_2 = fielder_results_simple_fd_2,
                                       result_3 = fielder_results_simple_fd_3,
                                       result_4 = fielder_results_simple_fd_4,
                                       result_5 = fielder_results_simple_fd_5)

# Loop over the variables in var_hitter_list
for (j in 1:fielder_rep){
  
  for (i in 1:fielder_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(vars_fe, stat_fielder_t[[i + fielder_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_fielder_t_1[[i + fielder_stat_num*(j - 1)]],
                     sep = " + ")
    
    fielder_simple_fd[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = starting_data,
                                                  model = "fd",
                                                  index = c("id", "Anio_ref"))
        
    fielder_results_simple_fd[[j]][[i]] <- coeftest(fielder_simple_fd[[i + fielder_stat_num*(j - 1)]],
                                                         vcov = vcovHC(fielder_simple_fd[[i + fielder_stat_num*(j - 1)]],
                                                                       type = "HC1",
                                                                       cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(fielder_results_simple_fd[[j]],
          no.space = TRUE,
          type = "text",
          title = "Lanzadores Iniciales: Primeras Diferencias",
          covariate.labels = fielder_stats[[j]])
}
```

```{r hitter_stimation_1, include=FALSE}
# Significant variables:
# Pooling:
hitter_vars_1 <- c("X_Bateos",
                   "X_Porcentaje_On_base_plus_slugging_2",
                    "X_Porcentaje_on_base",
                    "X_Porcentaje_on_base_2",
                    "X_Porcentaje_slugging_2",
                    "X_Runs_batted_in",
                    "X_Triples",
                    "X_WAR",
                    "X_WAR_2")
# Add suffix "_t" to each name
stat_hitter_t <- paste0(hitter_vars_1, "_t")
stat_hitter_t_1 <- paste0(hitter_vars_1, "_t_1")
# Lista 
hitter_vars_1 <- c(paste(stat_hitter_t, collapse = " + "),
                   paste(stat_hitter_t_1, collapse = " + "))
# Within
hitter_vars_2 <- c("X_Bateos",
                   "X_Porcentaje_On_base_plus_slugging_2",
                   "X_Porcentaje_on_base",
                   "X_Porcentaje_on_base_2",
                    "X_Porcentaje_slugging_2",
                    "X_Runs_batted_in",
                    "X_Triples",
                    "X_WAR",
                    "X_WAR_2")
# Add suffix "_t" to each name
stat_hitter_t <- paste0(hitter_vars_2, "_t")
stat_hitter_t_1 <- paste0(hitter_vars_2, "_t_1")
# Lista 
hitter_vars_2 <- c(paste(stat_hitter_t, collapse = " + "),
                   paste(stat_hitter_t_1, collapse = " + "))
# Random effects
hitter_vars_3 <- c("X_Porcentaje_On_base_plus_slugging_2",
                   "X_Triples",
                   "X_WAR",
                   "X_WAR_2")
# Add suffix "_t" to each name
stat_hitter_t <- paste0(hitter_vars_3, "_t")
stat_hitter_t_1 <- paste0(hitter_vars_3, "_t_1")
# Lista 
hitter_vars_3 <- c(paste(stat_hitter_t, collapse = " + "),
                   paste(stat_hitter_t_1, collapse = " + "))
# First Differences
hitter_vars_4 <- c("X_At_bats",
                   "X_Bateos_2",
                   "X_Bateos",
                   "X_Bateos_promedio",
                   "X_Bateos_promedio_2",
                   "X_Home_runs",
                   "X_Home_runs_2",
                   "X_Juegos_iniciados",
                   "X_Porcentaje_On_base_plus_slugging",
                   "X_Porcentaje_on_base",
                   "X_Porcentaje_on_base_2",
                   "X_Runs_batted_in",
                   "X_Triples",
                   "X_Triples_2",
                   "X_WAR",
                   "X_WAR_2")
# Add suffix "_t" to each name
stat_hitter_t <- paste0(hitter_vars_4, "_t")
stat_hitter_t_1 <- paste0(hitter_vars_4, "_t_1")
# Lista 
hitter_vars_4 <- c(paste(stat_hitter_t, collapse = " + "),
                   paste(stat_hitter_t_1, collapse = " + "))

# Pooling:
formula <- paste(vars_ms,
                 hitter_vars_1[[1]],
                 sep = " + ")
formula <- paste(formula,
                 hitter_vars_1[[2]],
                 sep = " + ")
# Create a model to store the results
hitter_stimation_1 <- plm(formula, data = hitter_data,
                          model = "pooling",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_1 <- coeftest(hitter_stimation_1,
                                       vcov = vcovHC(hitter_stimation_1,
                                                     type = "HC1",
                                                     cluster = "group"))
# Within:
formula <- paste(vars_fe,
                 hitter_vars_2[[1]],
                 sep = " + ")
formula <- paste(formula,
                 hitter_vars_2[[2]],
                 sep = " + ")
# Create a model to store the results
hitter_stimation_2 <- plm(formula, data = hitter_data,
                          model = "within",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_2 <- coeftest(hitter_stimation_2,
                                       vcov = vcovHC(hitter_stimation_2,
                                                     type = "HC1",
                                                     cluster = "group"))
# Random:
formula <- paste(vars_ms,
                 hitter_vars_3[[1]],
                 sep = " + ")
formula <- paste(formula,
                 hitter_vars_3[[2]],
                 sep = " + ")
# Create a model to store the results
hitter_stimation_3 <- plm(formula, data = hitter_data,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_3 <- coeftest(hitter_stimation_3,
                                       vcov = vcovHC(hitter_stimation_3,
                                                     type = "HC1",
                                                     cluster = "group"))
# First Differences:
formula <- paste(vars_fe,
                 hitter_vars_4[[1]],
                 sep = " + ")
formula <- paste(formula,
                 hitter_vars_4[[2]],
                 sep = " + ")
# Create a model to store the results
hitter_stimation_4 <- plm(formula, data = hitter_data,
                          model = "fd",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_4 <- coeftest(hitter_stimation_4,
                                       vcov = vcovHC(hitter_stimation_4,
                                                     type = "HC1",
                                                     cluster = "group"))

# Modelos
hitter_models <- list(pooling = hitter_results_stimation_1,
                      within = hitter_results_stimation_2,
                      random = hitter_results_stimation_3,
                      fd = hitter_results_stimation_4)


# Print the third block of results
stargazer(hitter_models,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Bateadores: Comparación de los modelos",
         covariate.labels = c("$Edad_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                              "$X_{AB_{t}}$", "$X_{H^{2}_{t}}$", "$X_{H_{t}}$",
                              "$X_{OPS^{2}_{t}}$",
                              "$X_{BA_{t}}$", "$X_{BA^{2}_{t}}$",
                              "$X_{HR_{t}}$", "$X_{HR^{2}_{t}}$", 
                              "$X_{GS_{t}}$", "$X_{OPS_{t}}$", 
                              "$X_{OBP_{t}}$", "$X_{OBP^{2}_{t}}$",
                              "$X_{SLG^{2}_{t}}$", "$X_{RBI_{t}}$",
                              "$X_{T_{t}}$","$X_{T^{2}_{t}}$", 
                              "$X_{WAR_{t}}$", "$X_{WAR^{2}_{t}}$", 
                              "$X_{AB_{t-1}}$", "$X_{H^{2}_{t-1}}$", "$X_{H_{t-1}}$",
                              "$X_{OPS^{2}_{t-1}}$",
                              "$X_{BA_{t-1}}$", "$X_{BA^{2}_{t-1}}$",
                              "$X_{HR_{t-1}}$", "$X_{HR^{2}_{t-1}}$", 
                              "$X_{GS_{t-1}}$", "$X_{OPS_{t-1}}$",
                              "$X_{OBP_{t-1}}$", "$X_{OBP^{2}_{t-1}}$",
                              "$X_{SLG^{2}_{t-1}}$", "$X_{RBI_{t-1}}$",
                              "$X_{T_{t-1}}$","$X_{T^{2}_{t-1}}$", 
                              "$X_{WAR_{t-1}}$", "$X_{WAR^{2}_{t-1}}$", 
                              "Agente$_{t}$"),
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"))
```

```{r hitter_stimation_2, results=TRUE}
# Significant variables:
# Pooling:
hitter_vars_1 <- c("X_Triples_t_1",
                    "X_WAR_t")
# Lista 
hitter_vars_1 <- paste(hitter_vars_1, collapse = " + ")
# Within
hitter_vars_2 <- c("X_Porcentaje_on_base_t_1",
                   "X_WAR_t")
# Lista 
hitter_vars_2 <- paste(hitter_vars_2, collapse = " + ")
# Random effects
hitter_vars_3 <- c("X_Porcentaje_On_base_plus_slugging_2_t",
                   "X_Triples_t_1",
                   "X_WAR_t")
# Lista 
hitter_vars_3 <- paste(hitter_vars_3, collapse = " + ")
# First Differences
hitter_vars_4 <- c("X_At_bats_t","X_At_bats_t_1",
                   "X_Bateos_t",
                   "X_Bateos_2_t","X_Bateos_2_t_1",
                   "X_Juegos_iniciados_t","X_Juegos_iniciados_t_1",
                   "X_Porcentaje_On_base_plus_slugging_t","X_Porcentaje_On_base_plus_slugging_t_1",
                   "X_Porcentaje_on_base_t","X_Porcentaje_on_base_t_1",
                   "X_Porcentaje_on_base_2_t",
                   "X_Triples_t", "X_Triples_2_t",
                   "X_WAR_t","X_WAR_t_1",
                   "X_WAR_2_t",
                   "X_Bateos_promedio_t_1",
                   "X_Home_runs_t_1",
                   "X_Runs_batted_in_t_1")
# Lista 
hitter_vars_4 <- paste(hitter_vars_4, collapse = " + ")


# Pooling:
formula <- paste(vars_ms,
                 hitter_vars_1,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_1 <- plm(formula, data = hitter_data,
                          model = "pooling",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_1 <- coeftest(hitter_stimation_1,
                                       vcov = vcovHC(hitter_stimation_1,
                                                     type = "HC1",
                                                     cluster = "group"))
# Within:
formula <- paste(vars_fe,
                 hitter_vars_2,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_2 <- plm(formula, data = hitter_data,
                          model = "within",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_2 <- coeftest(hitter_stimation_2,
                                       vcov = vcovHC(hitter_stimation_2,
                                                     type = "HC1",
                                                     cluster = "group"))
# Random:
formula <- paste(vars_ms,
                 hitter_vars_3,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_3 <- plm(formula, data = hitter_data,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_3 <- coeftest(hitter_stimation_3,
                                       vcov = vcovHC(hitter_stimation_3,
                                                     type = "HC1",
                                                     cluster = "group"))
# First Differences:
formula <- paste(vars_fe,
                 hitter_vars_4,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_4 <- plm(formula, data = hitter_data,
                          model = "fd",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_4 <- coeftest(hitter_stimation_4,
                                       vcov = vcovHC(hitter_stimation_4,
                                                     type = "HC1",
                                                     cluster = "group"))

# Modelos
hitter_models <- list(pooling = hitter_results_stimation_1,
                      within = hitter_results_stimation_2,
                      random = hitter_results_stimation_3,
                      fd = hitter_results_stimation_4)


# Print the third block of results
stargazer(hitter_models,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Bateadores: Comparación de los modelos - Primer refinamiento",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"))
```

```{r hitter_stimation_3, results=TRUE}
# Significant variables:
# Pooling:
hitter_vars_1 <- c("X_Triples_t_1",
                    "X_WAR_t")
# Lista 
hitter_vars_1 <- paste(hitter_vars_1, collapse = " + ")

# Within
hitter_vars_2 <- c("X_WAR_t")

# Random effects
hitter_vars_3 <- c("X_WAR_t")

# First Difference
hitter_vars_4 <- c("X_At_bats_t","X_At_bats_t_1",
                   "X_Bateos_t",
                   "X_Bateos_2_t_1",
                   "X_Juegos_iniciados_t","X_Juegos_iniciados_t_1",
                   "X_Porcentaje_On_base_plus_slugging_t","X_Porcentaje_On_base_plus_slugging_t_1",
                   "X_Porcentaje_on_base_t_1",
                   "X_Porcentaje_on_base_2_t",
                   "X_Triples_t", "X_Triples_2_t",
                   "X_WAR_t","X_WAR_t_1",
                   "X_WAR_2_t",
                   "X_Home_runs_t_1",
                   "X_Runs_batted_in_t_1")
# Lista 
hitter_vars_4 <- paste(hitter_vars_4, collapse = " + ")


# Pooling:
formula <- paste(vars_ms,
                 hitter_vars_1,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_1 <- plm(formula, data = hitter_data,
                          model = "pooling",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_1 <- coeftest(hitter_stimation_1,
                                       vcov = vcovHC(hitter_stimation_1,
                                                     type = "HC1",
                                                     cluster = "group"))
# Within:
formula <- paste(vars_fe,
                 hitter_vars_2,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_2 <- plm(formula, data = hitter_data,
                          model = "within",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_2 <- coeftest(hitter_stimation_2,
                                       vcov = vcovHC(hitter_stimation_2,
                                                     type = "HC1",
                                                     cluster = "group"))
# Random:
formula <- paste(vars_ms,
                 hitter_vars_3,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_3 <- plm(formula, data = hitter_data,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_3 <- coeftest(hitter_stimation_3,
                                       vcov = vcovHC(hitter_stimation_3,
                                                     type = "HC1",
                                                     cluster = "group"))
# First Differences:
formula <- paste(vars_fe,
                 hitter_vars_4,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_4 <- plm(formula, data = hitter_data,
                          model = "fd",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_4 <- coeftest(hitter_stimation_4,
                                       vcov = vcovHC(hitter_stimation_4,
                                                     type = "HC1",
                                                     cluster = "group"))

# Modelos
hitter_models <- list(pooling = hitter_results_stimation_1,
                      within = hitter_results_stimation_2,
                      random = hitter_results_stimation_3,
                      fd = hitter_results_stimation_4)


# Print the third block of results
stargazer(hitter_models,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Bateadores: Comparación de los modelos - Segundo refinamiento",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"))
```

```{r hitter_stimation_ecom, results=TRUE}
# Significant variables:
# Pooling:
hitter_vars_1 <- c("X_Triples_t_1",
                    "X_WAR_t")
# Lista 
hitter_vars_1 <- paste(hitter_vars_1, collapse = " + ")

# Within
hitter_vars_2 <- c("X_WAR_t")

# Random effects
hitter_vars_3 <- c("X_WAR_t")

# First Differences
hitter_vars_4 <- c("X_At_bats_t","X_At_bats_t_1",
                   "X_Bateos_t",
                   "X_Bateos_2_t_1",
                   "X_Juegos_iniciados_t","X_Juegos_iniciados_t_1",
                   "X_Porcentaje_On_base_plus_slugging_t_1",
                   "X_Porcentaje_on_base_t_1",
                   "X_Porcentaje_on_base_2_t",
                   "X_Triples_t", "X_Triples_2_t",
                   "X_WAR_t","X_WAR_t_1",
                   "X_WAR_2_t",
                   "X_Home_runs_t_1",
                   "X_Runs_batted_in_t_1")
# Lista 
hitter_vars_4 <- paste(hitter_vars_4, collapse = " + ")


# Pooling:
formula <- paste(vars_ms,
                 hitter_vars_1,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_1 <- plm(formula, data = hitter_data,
                          model = "pooling",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_1 <- coeftest(hitter_stimation_1,
                                       vcov = vcovHC(hitter_stimation_1,
                                                     type = "HC1",
                                                     cluster = "group"))
# Within:
formula <- paste(vars_fe,
                 hitter_vars_2,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_2 <- plm(formula, data = hitter_data,
                          model = "within",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_2 <- coeftest(hitter_stimation_2,
                                       vcov = vcovHC(hitter_stimation_2,
                                                     type = "HC1",
                                                     cluster = "group"))
# Random:
formula <- paste(vars_ms,
                 hitter_vars_3,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_3 <- plm(formula, data = hitter_data,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_3 <- coeftest(hitter_stimation_3,
                                       vcov = vcovHC(hitter_stimation_3,
                                                     type = "HC1",
                                                     cluster = "group"))
# First Differences:
formula <- paste(vars_fe,
                 hitter_vars_4,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_4 <- plm(formula, data = hitter_data,
                          model = "fd",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_4 <- coeftest(hitter_stimation_4,
                                       vcov = vcovHC(hitter_stimation_4,
                                                     type = "HC1",
                                                     cluster = "group"))

# Modelos
hitter_models <- list(pooling = hitter_results_stimation_1,
                      within = hitter_results_stimation_2,
                      random = hitter_results_stimation_3,
                      fd = hitter_results_stimation_4)
# List to store results
hitter_end_models <- list(pooling = hitter_stimation_1,
                          within = hitter_stimation_2,
                          random = hitter_stimation_3,
                          fd = hitter_stimation_4)

# Print the third block of results
stargazer(hitter_models,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Bateadores: Comparación de los modelos - Econométrico final",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"))
```

```{r hausman_cojoint_hitter, results=TRUE}
# create an empty list to store the test results
test_results <- list()

# loop through every possible pair of models
for (i in 1:(length(hitter_end_models)-1)) {
  for (j in (i+1):length(hitter_end_models)) {
    # apply phtest to the pair of models
    test_result <- phtest(hitter_end_models[[i]], hitter_end_models[[j]])
    # add the test result to the list
    test_results[[paste0(names(hitter_end_models[i]), "_vs_", names(hitter_end_models[j]))]] <- test_result
  }
}

# view the test results
test_results
```

```{r fielder_stimation_pooling_1, results=TRUE}
# Significant variables:
fielder_vars_1 <- c('X_Control_2',
                    'X_Control',
                    'X_Dominio_2',
                    'X_Dominio',
                    'X_ERA_2',
                    'X_ERA',
                    'X_Saves_2',
                    'X_Saves',
                    'X_WHIP_2',
                    'X_WHIP')
# Add suffix "_t" to each name
stat_fielder_t <- paste0(fielder_vars_1, "_t")
stat_fielder_t_1 <- paste0(fielder_vars_1, "_t_1")
# Lista 
fielder_vars_1 <- c(paste(stat_fielder_t, collapse = " + "),
                   paste(stat_fielder_t_1, collapse = " + "))
# Within
fielder_vars_2 <- c('X_Carreras',
                    'X_Comando_2',
                    'X_ERA',
                    'X_Saves_2',
                    'X_Saves',
                    'X_Strike_outs_2',
                    'X_WAR_2')
# Add suffix "_t" to each name
stat_fielder_t <- paste0(fielder_vars_2, "_t")
stat_fielder_t_1 <- paste0(fielder_vars_2, "_t_1")
# Lista 
fielder_vars_2 <- c(paste(stat_fielder_t, collapse = " + "),
                   paste(stat_fielder_t_1, collapse = " + "))
# Random effects
fielder_vars_3 <- c('X_Control_2',
                    'X_Control',
                    'X_Dominio_2',
                    'X_Dominio',
                    'X_ERA_2',
                    'X_ERA',
                    'X_Saves_2',
                    'X_Saves',
                    'X_WHIP_2',
                    'X_WHIP')
# Add suffix "_t" to each name
stat_fielder_t <- paste0(fielder_vars_3, "_t")
stat_fielder_t_1 <- paste0(fielder_vars_3, "_t_1")
# Lista 
fielder_vars_3 <- c(paste(stat_fielder_t, collapse = " + "),
                   paste(stat_fielder_t_1, collapse = " + "))
# First Differences
fielder_vars_4 <- c('X_Bateos_2',
                    'X_Bateos',
                    'X_Carreras_ganadas_2',
                    'X_Carreras_ganadas',
                    'X_ERA',
                    'X_Carreras',
                    'X_Comando_2',
                    'X_Comando',
                    'X_Control_2',
                    'X_Control',
                    'X_Dominio_2',
                    'X_Dominio',
                    'X_Inning_pitched_2',
                    'X_Inning_pitched',
                    'X_Losses_2',
                    'X_Saves_2',
                    'X_Saves',
                    'X_Strike_outs_2',
                    'X_Strike_outs',
                    'X_WAR_2', 
                    'X_WHIP_2',
                    'X_WHIP',
                    'X_Walks_2',
                    'X_Walks',
                    'X_Wins')
# Add suffix "_t" to each name
stat_fielder_t <- paste0(fielder_vars_4, "_t")
stat_fielder_t_1 <- paste0(fielder_vars_4, "_t_1")
# Lista 
fielder_vars_4 <- c(paste(stat_fielder_t, collapse = " + "),
                   paste(stat_fielder_t_1, collapse = " + "))


# Pooling:
formula <- paste(vars_ms,
                 fielder_vars_1[[1]],
                 sep = " + ")
formula <- paste(formula,
                 fielder_vars_1[[2]],
                 sep = " + ")
# Create a model to store the results
fielder_stimation_1 <- plm(formula, data = starting_data,
                          model = "pooling",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_1 <- coeftest(fielder_stimation_1,
                                       vcov = vcovHC(fielder_stimation_1,
                                                     type = "HC1",
                                                     cluster = "group"))
# Within:
formula <- paste(vars_fe,
                 fielder_vars_2[[1]],
                 sep = " + ")
formula <- paste(formula,
                 fielder_vars_2[[2]],
                 sep = " + ")
# Create a model to store the results
fielder_stimation_2 <- plm(formula, data = starting_data,
                          model = "within",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_2 <- coeftest(fielder_stimation_2,
                                       vcov = vcovHC(fielder_stimation_2,
                                                     type = "HC1",
                                                     cluster = "group"))
# Random:
formula <- paste(vars_ms,
                 fielder_vars_3[[1]],
                 sep = " + ")
formula <- paste(formula,
                 fielder_vars_3[[2]],
                 sep = " + ")
# Create a model to store the results
fielder_stimation_3 <- plm(formula, data = starting_data,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_3 <- coeftest(fielder_stimation_3,
                                       vcov = vcovHC(fielder_stimation_3,
                                                     type = "HC1",
                                                     cluster = "group"))
# First Differences:
formula <- paste(vars_fe,
                 fielder_vars_4[[1]],
                 sep = " + ")
formula <- paste(formula,
                 fielder_vars_4[[2]],
                 sep = " + ")
# Create a model to store the results
fielder_stimation_4 <- plm(formula, data = starting_data ,
                          model = "fd",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_4 <- coeftest(fielder_stimation_4,
                                       vcov = vcovHC(fielder_stimation_4,
                                                     type = "HC1",
                                                     cluster = "group"))

# Models
fielder_models <- list(pooling = fielder_results_stimation_1,
                      within = fielder_results_stimation_2,
                      random = fielder_results_stimation_3,
                      fd = fielder_results_stimation_4)

# Print the third block of results
stargazer(fielder_models,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Lanzadores Iniciales: Comparación de los modelos",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"))
```

```{r fielder_stimation_pooling_2, results=TRUE}
# Significant variables:
fielder_vars_1 <- c('X_Control_2_t',
                    'X_Control_t',
                    'X_Dominio_t_1',
                    'X_ERA_t_1',
                    'X_ERA_t',
                    'X_Saves_2_t_1',
                    'X_Saves_t_1')
# Lista 
fielder_vars_1 <- paste(fielder_vars_1, collapse = " + ")
# Within
fielder_vars_2 <- c('X_ERA_t_1',
                    'X_Saves_2_t',
                    'X_Saves_2_t_1',
                    'X_Saves_t',
                    'X_WAR_2_t_1')
# Lista 
fielder_vars_2 <- paste(fielder_vars_2, collapse = " + ")
# Random effects
fielder_vars_3 <- c('X_Control_2_t',
                    'X_Control_t',
                    'X_Dominio_t_1',
                    'X_ERA_t',
                    'X_ERA_t_1',
                    'X_Saves_2_t_1',
                    'X_Saves_t_1')
# Lista 
fielder_vars_3 <- paste(fielder_vars_3, collapse = " + ")
# First Differences
fielder_vars_4 <- c('X_Bateos_2_t',
                    'X_Bateos_2_t_1',
                    'X_Bateos_t',
                    'X_Carreras_ganadas_2_t',
                    'X_ERA_t',
                    'X_ERA_t_1',
                    'X_Carreras_t',
                    'X_Comando_2_t_1',
                    'X_Comando_t',
                    'X_Comando_t_1',
                    'X_Control_2_t_1',
                    'X_Control_t_1',
                    'X_Dominio_2_t',
                    'X_Dominio_t',
                    'X_Dominio_2_t_1',
                    'X_Dominio_t_1',
                    'X_Inning_pitched_2_t',
                    'X_Inning_pitched_t',
                    'X_Inning_pitched_t_1',
                    'X_Losses_2_t_1',
                    'X_Saves_2_t',
                    'X_Saves_t',
                    'X_Strike_outs_2_t_1',
                    'X_Strike_outs_t',
                    'X_Strike_outs_t_1',
                    'X_WAR_2_t_1', 
                    'X_WHIP_2_t',
                    'X_Walks_2_t',
                    'X_Walks_t',
                    'X_Wins_t_1')
# Lista 
fielder_vars_4 <- paste(fielder_vars_4, collapse = " + ")


# Pooling:
formula <- paste(vars_ms,
                 fielder_vars_1,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_1 <- plm(formula, data = starting_data,
                          model = "pooling",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_1 <- coeftest(fielder_stimation_1,
                                       vcov = vcovHC(fielder_stimation_1,
                                                     type = "HC1",
                                                     cluster = "group"))
# Within:
formula <- paste(vars_fe,
                 fielder_vars_2,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_2 <- plm(formula, data = starting_data,
                          model = "within",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_2 <- coeftest(fielder_stimation_2,
                                       vcov = vcovHC(fielder_stimation_2,
                                                     type = "HC1",
                                                     cluster = "group"))
# Random:
formula <- paste(vars_ms,
                 fielder_vars_3,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_3 <- plm(formula, data = starting_data,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_3 <- coeftest(fielder_stimation_3,
                                       vcov = vcovHC(fielder_stimation_3,
                                                     type = "HC1",
                                                     cluster = "group"))
# First Differences:
formula <- paste(vars_fe,
                 fielder_vars_4,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_4 <- plm(formula, data = starting_data ,
                          model = "fd",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_4 <- coeftest(fielder_stimation_4,
                                       vcov = vcovHC(fielder_stimation_4,
                                                     type = "HC1",
                                                     cluster = "group"))

# Modelos
fielder_models <- list(pooling = fielder_results_stimation_1,
                      within = fielder_results_stimation_2,
                      random = fielder_results_stimation_3,
                      fd = fielder_results_stimation_4)


# Print the third block of results
stargazer(fielder_models,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Lanzadores Iniciales: Comparación de los modelos - Primer refinamiento",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"))
```

```{r fielder_stimation_pooling_ecom, results=TRUE}
# Significant variables:
fielder_vars_1 <- c('X_Control_2_t',
                    'X_Control_t',
                    'X_Dominio_t_1',
                    'X_ERA_t_1',
                    'X_ERA_t',
                    'X_Saves_2_t_1',
                    'X_Saves_t_1')
# Lista 
fielder_vars_1 <- paste(fielder_vars_1, collapse = " + ")
# Within
fielder_vars_2 <- c('X_ERA_t_1',
                    'X_Saves_2_t',
                    'X_Saves_2_t_1',
                    'X_Saves_t',
                    'X_WAR_2_t_1')
# Lista 
fielder_vars_2 <- paste(fielder_vars_2, collapse = " + ")
# Random effects
fielder_vars_3 <- c('X_Control_2_t',
                    'X_Control_t',
                    'X_Dominio_t_1',
                    'X_ERA_t',
                    'X_ERA_t_1',
                    'X_Saves_2_t_1',
                    'X_Saves_t_1')
# Lista 
fielder_vars_3 <- paste(fielder_vars_3, collapse = " + ")
# First Differences
fielder_vars_4 <- c('X_Bateos_2_t',
                    'X_Bateos_2_t_1',
                    'X_Bateos_t',
                    'X_Carreras_ganadas_2_t',
                    'X_ERA_t',
                    'X_ERA_t_1',
                    'X_Carreras_t',
                    'X_Comando_2_t_1',
                    'X_Comando_t',
                    'X_Comando_t_1',
                    'X_Control_2_t_1',
                    'X_Control_t_1',
                    'X_Dominio_2_t',
                    'X_Dominio_t',
                    'X_Dominio_2_t_1',
                    'X_Dominio_t_1',
                    'X_Inning_pitched_2_t',
                    'X_Losses_2_t_1',
                    'X_Saves_2_t',
                    'X_Saves_t',
                    'X_Strike_outs_2_t_1',
                    'X_Strike_outs_t',
                    'X_Strike_outs_t_1',
                    'X_WAR_2_t_1', 
                    'X_WHIP_2_t',
                    'X_Walks_2_t',
                    'X_Walks_t',
                    '-1')
# Lista 
fielder_vars_4 <- paste(fielder_vars_4, collapse = " + ")


# Pooling:
formula <- paste(vars_ms,
                 fielder_vars_1,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_1 <- plm(formula, data = starting_data,
                          model = "pooling",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_1 <- coeftest(fielder_stimation_1,
                                       vcov = vcovHC(fielder_stimation_1,
                                                     type = "HC1",
                                                     cluster = "group"))
# Within:
formula <- paste(vars_fe,
                 fielder_vars_2,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_2 <- plm(formula, data = starting_data,
                          model = "within",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_2 <- coeftest(fielder_stimation_2,
                                       vcov = vcovHC(fielder_stimation_2,
                                                     type = "HC1",
                                                     cluster = "group"))
# Random:
formula <- paste(vars_ms,
                 fielder_vars_3,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_3 <- plm(formula, data = starting_data,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_3 <- coeftest(fielder_stimation_3,
                                       vcov = vcovHC(fielder_stimation_3,
                                                     type = "HC1",
                                                     cluster = "group"))
# First Differences:
formula <- paste(vars_fe,
                 fielder_vars_4,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_4 <- plm(formula, data = starting_data ,
                          model = "fd",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_4 <- coeftest(fielder_stimation_4,
                                       vcov = vcovHC(fielder_stimation_4,
                                                     type = "HC1",
                                                     cluster = "group"))

# Modelos
fielder_models <- list(pooling = fielder_results_stimation_1,
                      within = fielder_results_stimation_2,
                      random = fielder_results_stimation_3,
                      fd = fielder_results_stimation_4)
# List to store models:
fielder_end_models <- list(pooling = fielder_stimation_1,
                            within = fielder_stimation_2,
                            random = fielder_stimation_3,
                            fd = fielder_stimation_4)

# Print the third block of results
stargazer(fielder_models,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Lanzadores Iniciales: Comparación de los modelos - Segundo refinamiento",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"))
```

```{r hausman_cojoint_fielder, results=TRUE}
# create an empty list to store the test results
test_results <- list()

# loop through every possible pair of models
for (i in 1:(length(fielder_end_models)-1)) {
  for (j in (i+1):length(fielder_end_models)) {
    # apply phtest to the pair of models
    test_result <- phtest(fielder_end_models[[i]], fielder_end_models[[j]])
    # add the test result to the list
    test_results[[paste0(names(fielder_end_models[i]), "_vs_", names(fielder_end_models[j]))]] <- test_result
  }
}

# view the test results
test_results
```

# Cambio estructural para el 2020 - COVID-19

Estimaremos los mismos modelos refinados, pero omitiendo el año 2020 para evaluar si hay un cambio estructural.

### Bateadores

```{r hitter_stimation_cov, echo=FALSE, eval=TRUE}
# Pooling:
formula <- paste(vars_ms,
                 hitter_vars_1,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_1_cov <- plm(formula, data = hitter_cov_data,
                              model = "pooling",
                              index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_1_cov <- coeftest(hitter_stimation_1,
                                           vcov = vcovHC(hitter_stimation_1,
                                                         type = "HC1",
                                                         cluster = "group"))
# Within:
formula <- paste(vars_ms,
                 hitter_vars_2,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_2_cov <- plm(formula, data = hitter_cov_data,
                              model = "within",
                              index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_2_cov <- coeftest(hitter_stimation_2,
                                           vcov = vcovHC(hitter_stimation_2,
                                                         type = "HC1",
                                                         cluster = "group"))
# Random:
formula <- paste(vars_ms,
                 hitter_vars_3,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_3_cov <- plm(formula, data = hitter_cov_data,
                              model = "random",
                              index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_3_cov <- coeftest(hitter_stimation_3,
                                           vcov = vcovHC(hitter_stimation_3,
                                                         type = "HC1",
                                                         cluster = "group"))
# First Differences:
formula <- paste(vars_fe,
                 hitter_vars_4,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_4_cov <- plm(formula, data = hitter_cov_data,
                              model = "fd",
                              index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_4_cov <- coeftest(hitter_stimation_4,
                                           vcov = vcovHC(hitter_stimation_4,
                                                         type = "HC1",
                                                         cluster = "group"))

# Models:
hitter_models_cov <- list(pooling = hitter_results_stimation_1_cov,
                          within = hitter_results_stimation_2_cov,
                          random = hitter_results_stimation_3_cov,
                          fd = hitter_results_stimation_4_cov)
# Store models:
hitter_end_models_cov <- list(pooling = hitter_stimation_1_cov,
                              within = hitter_stimation_2_cov,
                              random = hitter_stimation_3_cov,
                              fd = hitter_stimation_4_cov)

# Print the third block of results
stargazer(hitter_models_cov,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Bateadores: Comparación de los modelos - COVID-19",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"),
         covariate.labels = c("$Edad_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                              "$X_{T_{t-1}}$", "$X_{BA_{t-1}}$", "$X_{GS_{t-1}}$", 
                              "$X_{OBP^{2}_{t}}$", "$X_{WAR_{t}}$", "$X_{WAR^{2}_{t}}$",
                              "Intercepto"))
```

### Fildeadores

```{r fielder_stimation_pooling_cov, echo=FALSE, eval=TRUE}
# Pooling:
formula <- paste(vars_ms,
                 fielder_vars_1,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_1_cov <- plm(formula, data = starting_cov_data,
                                model = "pooling",
                                index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_1_cov <- coeftest(fielder_stimation_1,
                                             vcov = vcovHC(fielder_stimation_1,
                                                           type = "HC1",
                                                           cluster = "group"))
# Within:
formula <- paste(vars_fe,
                 fielder_vars_2,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_2_cov <- plm(formula, data = starting_cov_data,
                                model = "within",
                                index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_2_cov <- coeftest(fielder_stimation_2,
                                             vcov = vcovHC(fielder_stimation_2,
                                                           type = "HC1",
                                                           cluster = "group"))
# Random:
formula <- paste(vars_ms,
                 fielder_vars_3,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_3_cov <- plm(formula, data = starting_cov_data,
                                model = "random",
                                index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_3_cov <- coeftest(fielder_stimation_3,
                                             vcov = vcovHC(fielder_stimation_3,
                                                           type = "HC1",
                                                           cluster = "group"))
# First Differences:
formula <- paste(vars_fe,
                 fielder_vars_4,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_4_cov <- plm(formula, data = starting_cov_data,
                                model = "fd",
                                index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_4_cov <- coeftest(fielder_stimation_4,
                                             vcov = vcovHC(fielder_stimation_4,
                                                           type = "HC1",
                                                           cluster = "group"))

# Modelos
fielder_models_cov <- list(pooling = fielder_results_stimation_1_cov,
                            within = fielder_results_stimation_2_cov,
                            random = fielder_results_stimation_3_cov,
                            fd = fielder_results_stimation_4_cov)
# Store model results:
fielder_end_models_cov <- list(pooling = fielder_stimation_1_cov,
                                within = fielder_stimation_2_cov,
                                random = fielder_stimation_3_cov,
                                fd = fielder_stimation_4_cov)

# Print the third block of results
stargazer(fielder_models_cov,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Lanzadores Iniciales: Comparación de los modelos - COVID-19",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"),
         covariate.labels = c("$Edad_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                              "$X_{Control^{2}_{t}}$", "$X_{Control_{t}}$",
                              "$X_{Dominio_{t-1}}$", "$X_{H_{t}}$",
                              "$X_{ER^{2}_{t}}$","$X_{ERA_{t-1}}$","$X_{ERA_{t}}$",
                              "$X_{S_{t-1}}$","$X_{S^{2}_{t-1}}$","$X_{S_{t}}$",
                              "$X_{Comando^{2}_{t-1}}$","$X_{Comando_{t}}$",
                              "$X_{Dominio_{t}}$","$X_{L^{2}_{t-1}}$",
                              "$X_{SO^{2}_{t-1}}$","$X_{SO_{t}}$","$X_{BB_{t}}$",
                              "Intercepto"))
```
Procedamos a realizar el test de Hausman para cada modelo

```{r hitter_hausman_covid, echo=FALSE, eval=TRUE}
# List to store results
hitter_test_covid <- list()
model_names <- c("Pooling",
                 "Within", 
                 "Random effects",
                 "First-Differences")

# Title:
print("Bateadores: Pruebas de Hausman para el COVID-19")
print("")
# Loop for applying results
for (i in 1:4){
  hitter_test_covid[[i]] <- phtest(hitter_end_models[[i]],hitter_end_models_cov[[i]])
  print(model_names[[i]])
  print(hitter_test_covid[[i]])
}
```
```{r fielder_hausman_covid}
# List to store results
fielder_test_covid <- list()
model_names <- c("Pooling",
                 "Within", 
                 "Random effects",
                 "First-Differences")

# Title:
print("Lanzadores iniciales: Pruebas de Hausman para el COVID-19")
print("")
# Loop for applying results
for (i in 1:4){
  fielder_test_covid[[i]] <- phtest(fielder_end_models[[i]],
                                    fielder_end_models_cov[[i]])
  print(model_names[[i]])
  print(fielder_test_covid[[i]])
}
```

# Comparación entre periodos

Obtendremos los estimadores para los primeros dos años de observación para luego compararlos con los estimadores para el resto de años. Primero, aseguremos que los páneles estén ordenados por nombre y año de referencia

```{r order_player_anio_ref}
# Sort dataframe by player name and year_ref
hitter_data <- hitter_data %>% arrange(Jugador, Anio_ref)
# Sort dataframe by player name and year_ref
starting_data <- starting_data %>% arrange(Jugador, Anio_ref)
```

```{r split_hitter_data_periods, include=FALSE}
# Split the data into two data frames
hitter_data_split <- hitter_data %>% 
                     group_split(Jugador) 

# Keep only the first two years in the first data frame
hitter_first_two <- hitter_data_split %>% 
                    lapply(function(x) if(nrow(x) >= 2) head(x, 2) else NULL) %>% 
                    bind_rows()

# Keep the remaining years in the second data frame
hitter_remaining <- hitter_data_split %>% 
                    lapply(function(x) if(nrow(x) > 2) tail(x, -2) else NULL) %>% 
                    bind_rows()
```

```{r split_fielder_data_periods, include=FALSE}
# Split the data into two data frames
starting_data_split <- starting_data %>% 
                      group_split(Jugador) 

# Keep only the first two years in the first data frame
starting_first_two <- starting_data_split %>% 
                      lapply(function(x) if(nrow(x) >= 2) head(x, 2) else NULL) %>% 
                      bind_rows()

# Keep the remaining years in the second data frame
starting_remaining <- starting_data_split %>% 
                      lapply(function(x) if(nrow(x) > 2) tail(x, -2) else NULL) %>% 
                      bind_rows()
```

Haremos las estimaciones con todos los modelos para obtener un análisis robusto

## Primeros dos años

## Pooling 

### Bateadores

```{r hitter_stimation_simple_pooling_fa, echo=FALSE, eval=TRUE}
# To store models
hitter_model_pooling_fa <- list()

# loop over the variables in var_hitter_list
for (i in 1:length(stat_hitter_t_1)){
  # run linear regression with grouped errors by country and robust errors
  base_vars_h  <- paste(vars_ms, stat_hitter_t[[i]],
                      sep = '+')
  formula <- paste(base_vars_h,
                   stat_hitter_t_1[[i]],
                   sep = " + ")
  
  hitter_model_pooling_fa[[i]] <- plm(formula, data = hitter_first_two,
                                      model = "pooling",
                                      index = c("id", "Anio_ref"))
  
  my_lm_cluster_i <- coeftest(hitter_model_pooling_fa[[i]],
                              vcov = vcovHC(hitter_model_pooling_fa[[i]],
                                            type = "HC1",
                                            cluster = "group"))
  
  h_m_pooled_f <- plm(formula, data = hitter_remaining,
                      model = "pooling",
                      index = c("id", "Anio_ref"))
  
  my_lm_cluster_f <- coeftest(h_m_pooled_f,
                              vcov = vcovHC(h_m_pooled_f,
                                            type = "HC1",
                                            cluster = "group"))
  
  # To store models
  h_m_pooled <- list(my_lm_cluster_i,my_lm_cluster_f)
  
  # Print the third block of results
  #stargazer(h_m_pooled,
  #          no.space = TRUE,
  #          type = "text",
   #         title = "Bateadores regulares: Efecto de la edad (Pooling)",
    #        column.labels = c("Primeros dos años", "Años restantes"),
     #       covariate.labels = hitter_stats_long[[i]])
  
  # Hausman test:
  print("")
  print("Test para cambio estructural entre periodos:")
  print(phtest(hitter_model_pooling_fa[[i]],h_m_pooled_f))
}
```

### Starting pitcher

```{r starting_stimation_pooling_ini, echo=FALSE, eval=TRUE}
# To store models
fielder_model_pooling_fa <- list()

# loop over the variables in var_hitter_list
for (i in 1:length(stat_fielder_t_1)){
  # run linear regression with grouped errors by country and robust errors
  base_vars_s  <- paste(vars_ms, stat_fielder_t[[i]],
                      sep = '+')
  formula <- paste(base_vars_s,
                   stat_fielder_t_1[[i]],
                   sep = " + ")
  
  fielder_model_pooling_fa[[i]] <- plm(formula, data = starting_first_two,
                                       model = "pooling",
                                       index = c("id", "Anio_ref"))
  
  my_lm_cluster_i <- coeftest(fielder_model_pooling_fa[[i]],
                              vcov = vcovHC(fielder_model_pooling_fa[[i]],
                                            type = "HC1",
                                            cluster = "group"))
  
  s_m_pooled_f <- plm(formula, data = starting_remaining,
                      model = "pooling",
                      index = c("id", "Anio_ref"))
  
  my_lm_cluster_f <- coeftest(s_m_pooled_f,
                              vcov = vcovHC(s_m_pooled_f,
                                            type = "HC1",
                                            cluster = "group"))
  # To store models
  s_m_pooled <- list(my_lm_cluster_i,my_lm_cluster_f)
  
  # Print the third block of results
  stargazer(s_m_pooled,
            no.space = TRUE,
            type = "text",
            title = "Lanzadores iniciales: Efecto de la edad (Pooling)",
            column.labels = c("Primeros dos años", "Años restantes"),
            covariate.labels = fielder_stats_long[[i]])
  
  # Hausman test:
  print("")
  print("Test para cambio estructural entre periodos:")
  print(phtest(fielder_model_pooling_fa[[i]],s_m_pooled_f))
}
```

## Efectos fijos

### Bateadores

```{r hitter_stimation_simple_within_ini, echo=FALSE, eval=TRUE}
# To store results:
hitter_model_fe_fa <- list()

# loop over the variables in var_hitter_list
for (i in 1:length(stat_hitter_t_1)){
  # run linear regression with grouped errors by country and robust errors
  base_vars_h <- paste(vars_fe, stat_hitter_t[[i]],
                      sep = '+')
  formula <- paste(base_vars_h,
                   stat_hitter_t_1[[i]],
                   sep = " + ")
  
  hitter_model_fe_fa[[i]] <- plm(formula, data = hitter_first_two,
                                  model = "within",
                                  index = c("id", "Anio_ref"))
  
  my_lm_cluster_i <- coeftest(hitter_model_fe_fa[[i]],
                              vcov = vcovHC(hitter_model_fe_fa[[i]],
                                            type = "HC1",
                                            cluster = "group"))

  h_m_fix_ef_f <- plm(formula, data = hitter_remaining,
                      model = "within",
                      index = c("id", "Anio_ref"))
  
  my_lm_cluster_f <- coeftest(h_m_fix_ef_f,
                              vcov = vcovHC(h_m_fix_ef_f,
                                            type = "HC1",
                                            cluster = "group"))
  
  # To store models
  h_m_fix_ef <- list(my_lm_cluster_i,my_lm_cluster_f)
  
  # Print the third block of results
  stargazer(h_m_fix_ef,
            no.space = TRUE,
            type = "text",
            title = "Bateadores regulares: Efecto de la edad (Within)",
            column.labels = c("Primeros dos años", "Años restantes"),
            covariate.labels = hitter_stats_long[[i]])
  
  # Hausman test:
  print("")
  print("Test para cambio estructural entre periodos:")
  print(phtest(hitter_model_fe_fa[[i]],h_m_fix_ef_f))
}
```

### Starting pitcher

```{r starting_stimation_within_ini, echo=FALSE, eval=TRUE}
# To store results:
fielder_model_fe_fa <- list()

# loop over the variables in var_hitter_list
for (i in 1:length(stat_fielder_t_1)){
  # run linear regression with grouped errors by country and robust errors
  base_vars_s <- paste(vars_fe, stat_fielder_t[[i]],
                      sep = '+')
  formula <- paste(base_vars_s,
                   stat_fielder_t_1[[i]],
                   sep = " + ")
  
  fielder_model_fe_fa[[i]] <- plm(formula, data = starting_first_two,
                                  model = "within",
                                  index = c("id", "Anio_ref"))
  
  my_lm_cluster_i <- coeftest(fielder_model_fe_fa[[i]],
                              vcov = vcovHC(fielder_model_fe_fa[[i]],
                                            type = "HC1",
                                            cluster = "group"))
  
  s_m_fix_ef_f <- plm(formula, data = starting_remaining,
                      model = "within",
                      index = c("id", "Anio_ref"))
  
  my_lm_cluster_f <- coeftest(s_m_fix_ef_f,
                            vcov = vcovHC(s_m_fix_ef_f,
                                          type = "HC1",
                                          cluster = "group"))
  
  # To store models
  s_m_fix_ef <- list(my_lm_cluster_i,my_lm_cluster_f)
  
  # Print the third block of results
  stargazer(s_m_fix_ef,
            no.space = TRUE,
            type = "text",
            title = "Lanzadores iniciales: Efecto de la edad (Within)",
            column.labels = c("Primeros dos años", "Años restantes"),
            covariate.labels = fielder_stats_long[[i]])
  
  # Hausman test:
  print("")
  print("Test para cambio estructural entre periodos:")
  print(phtest(fielder_model_fe_fa[[i]],s_m_fix_ef_f))
}
```

## Efectos aleatorios

### Bateadores

```{r hitter_stimation_simple_random_ini, echo=FALSE, eval=TRUE}
# To store results:
hitter_model_random_fa <- list()

# loop over the variables in var_hitter_list
for (i in 1:length(stat_hitter_t_1)){
  # run linear regression with grouped errors by country and robust errors
  base_vars_h  <- paste(vars_ms, stat_hitter_t[[i]],
                      sep = '+')
  formula <- paste(base_vars_h,
                   stat_hitter_t_1[[i]],
                   sep = " + ")
 
  hitter_model_random_fa[[i]] <- plm(formula, data = hitter_first_two,
                                     model = "random",
                                     index = c("id", "Anio_ref"))
  
  my_lm_cluster_i <- coeftest(hitter_model_random_fa[[i]],
                              vcov = vcovHC(hitter_model_random_fa[[i]],
                                            type = "HC1",
                                            cluster = "group"))
  print(my_lm_cluster_i)
  
  print("Remaining years:")
  h_m_random_f <- plm(formula, data = hitter_remaining,
                      model = "random",
                      index = c("id", "Anio_ref"))
  
  my_lm_cluster_f <- coeftest(h_m_random_f,
                              vcov = vcovHC(h_m_random_f,
                                            type = "HC1",
                                            cluster = "group"))
  
  # To store models
  h_m_random <- list(my_lm_cluster_i,my_lm_cluster_f)
  
  # Print the third block of results
  stargazer(h_m_random,
            no.space = TRUE,
            type = "text",
            title = "Bateadores regulares: Efecto de la edad (Random Effects)",
            column.labels = c("Primeros dos años", "Años restantes"),
            covariate.labels = hitter_stats_long[[i]])
  
  # Hausman test:
  print("")
  print("Test para cambio estructural entre periodos:")
  print(phtest(hitter_model_random_fa[[i]],h_m_random_f))
}
```

### Starting pitcher

```{r starting_stimation_random_ini, echo=FALSE, eval=TRUE}
# To store results:
fielder_model_random_fa <- list()

# loop over the variables in var_hitter_list
for (i in 1:length(stat_fielder_t_1)){
  # run linear regression with grouped errors by country and robust errors
  base_vars_s  <- paste(vars_ms, stat_fielder_t[[i]],
                      sep = '+')
  formula <- paste(base_vars_s,
                   stat_fielder_t_1[[i]],
                   sep = " + ")
  
  fielder_model_random_fa[[i]] <- plm(formula, data = starting_first_two,
                                      model = "random",
                                      index = c("id", "Anio_ref"))
  
  my_lm_cluster_i <- coeftest(fielder_model_random_fa[[i]],
                              vcov = vcovHC(fielder_model_random_fa[[i]],
                                            type = "HC1",
                                            cluster = "group"))
  
  s_m_random_f <- plm(formula, data = starting_remaining,
                      model = "random",
                      index = c("id", "Anio_ref"))
  
  my_lm_cluster_f <- coeftest(s_m_random_f,
                              vcov = vcovHC(s_m_random_f,
                                            type = "HC1",
                                            cluster = "group"))
  
  # To store models
  s_m_random_ef <- list(my_lm_cluster_i,my_lm_cluster_f)
  
  # Print the third block of results
  stargazer(s_m_random_ef,
            no.space = TRUE,
            type = "text",
            title = "Lanzadores iniciales: Efecto de la edad (Random Effects)",
            column.labels = c("Primeros dos años", "Años restantes"),
            covariate.labels = fielder_stats_long[[i]])
  
  # Hausman test:
  print("")
  print("Test para cambio estructural entre periodos:")
  print(phtest(fielder_model_random_fa[[i]],s_m_random_f))
}
```

## First Differences

### Bateadores

Se obtendrán las estimaciones de las variables referentes a estadísticas deportivas sin controles

```{r hitter_stimation_simple_fd_ini, echo=FALSE, eval=TRUE}
# To Store results:
hitter_model_fd_fa <- list()

# loop over the variables in var_hitter_list
for (i in 1:length(stat_hitter_t_1)){
  # run linear regression with grouped errors by country and robust errors
  base_vars_h  <- paste(vars_fe, stat_hitter_t[[i]],
                      sep = '+')
  formula <- paste(base_vars_h,
                   stat_hitter_t_1[[i]],
                   sep = " + ")
  
  hitter_model_fd_fa[[i]] <- plm(formula, data = hitter_first_two,
                                 model = "fd",
                                 index = c("id", "Anio_ref"))
  
  my_lm_cluster_i <- coeftest(hitter_model_fd_fa[[i]],
                              vcov = vcovHC(hitter_model_fd_fa[[i]],
                                            type = "HC1",
                                            cluster = "group"))
  
  h_m_first_d_f <- plm(formula, data = hitter_remaining,
                       model = "fd",
                       index = c("id", "Anio_ref"))
  
  my_lm_cluster_f <- coeftest(h_m_first_d_f,
                              vcov = vcovHC(h_m_first_d_f,
                                            type = "HC1",
                                            cluster = "group"))
  # To store models
  h_m_first_d <- list(my_lm_cluster_i,my_lm_cluster_f)
  
  # Print the third block of results
  stargazer(h_m_first_d,
            no.space = TRUE,
            type = "text",
            title = "Bateadores regulares: Efecto de la edad (First Differences)",
            column.labels = c("Primeros dos años", "Años restantes"),
            covariate.labels = hitter_stats_long[[i]])
  
  # Hausman test:
  print("")
  print("Test para cambio estructural entre periodos:")
  print(phtest(hitter_model_fd_fa[[i]],h_m_first_d_f))
}
```

### Starting pitcher

```{r starting_stimation_fd_ini, echo=FALSE, eval=TRUE}
# To Store results
fielder_model_fd_fa <- list()

# loop over the variables in var_hitter_list
for (i in 1:length(stat_fielder_t_1)){
  # run linear regression with grouped errors by country and robust errors
  base_vars_s  <- paste(vars_fe, stat_fielder_t[[i]],
                      sep = '+')
  formula <- paste(base_vars_s,
                   stat_fielder_t_1[[i]],
                   sep = " + ")
  
  fielder_model_fd_fa[[i]] <- plm(formula, data = starting_first_two,
                                  model = "fd",
                                  index = c("id", "Anio_ref"))
  
  my_lm_cluster_i <- coeftest(fielder_model_fd_fa[[i]],
                              vcov = vcovHC(fielder_model_fd_fa[[i]],
                                            type = "HC1",
                                            cluster = "group"))
  
  s_m_first_d_f <- plm(formula, data = starting_remaining,
                       model = "fd",
                       index = c("id", "Anio_ref"))
  
  my_lm_cluster_f <- coeftest(s_m_first_d_f,
                              vcov = vcovHC(s_m_first_d_f,
                                            type = "HC1",
                                            cluster = "group"))
  # To store models
  s_m_first_d <- list(my_lm_cluster_i,my_lm_cluster_f)
  
  # Print the third block of results
  stargazer(s_m_first_d,
            no.space = TRUE,
            type = "text",
            title = "Lanzadores iniciales: Efecto de la edad (First Differences)",
            column.labels = c("Primeros dos años", "Años restantes"),
            covariate.labels = fielder_stats_long[[i]])
  
  # Hausman test:
  print("")
  print("Test para cambio estructural entre periodos:")
  print(phtest(fielder_model_fd_fa[[i]],s_m_first_d_f))
}
```

# Cambio en el poder de negociación al convertirse en agente

Obtendremos el estimador del cambio en el poder de negociación un periodo antes de que el jugador se convierta en agente libre con el primer periodo como agente libre. Importemos las bases de datos

```{r import_panel_ch, include=FALSE}
setwd("~/Documentos/Github/Proyectos/MLB_HN/")
hitters_panel_ch <- read.csv('ETL_Data/Panel/Cumulative/Bargaining_change/panel_hitters_cum_ch.csv')
fielders_panel_ch <- read.csv('ETL_Data/Panel/Cumulative/Bargaining_change/panel_fielders_cum_ch.csv')
```

```{r position_dummyfication_ch, include=FALSE}
# Convert categorical column to numerical
hitters_panel_ch$position_num_t <- as.numeric(factor(hitters_panel_ch$Posicion_t))
fielders_panel_ch$position_num_t <- as.numeric(factor(fielders_panel_ch$Posicion_t))
hitters_panel_ch$team_num_t <- as.numeric(factor(hitters_panel_ch$Acronimo_t))
fielders_panel_ch$team_num_t <- as.numeric(factor(fielders_panel_ch$Acronimo_t))
```

```{r fa_dummy_ch, include=FALSE}
# add a column of 1s to the panel data
hitters_panel_ch <- cbind(hitters_panel_ch,
                          fa = rep(1, nrow(hitters_panel_ch)))
fielders_panel_ch <- cbind(fielders_panel_ch,
                            fa = rep(1, nrow(fielders_panel_ch)))
```

```{r position_split_ch, include=FALSE}
# split the data frame by category
split_hitter_ch <- split(hitters_panel_ch,
                         f = hitters_panel_ch$Posicion_t)
split_fielder_ch <- split(fielders_panel_ch,
                          f = fielders_panel_ch$Posicion_t)
```

```{r group_category_split_ch_1, include=FALSE}
# Whole panel:
# Offensive:
h_category_1_ch <- split_hitter_ch[["SP"]]
h_category_2_ch <- split_hitter_ch[["RP"]]
h_category_3_ch <- split_hitter_ch[["RP/CL"]]
h_category_4_ch <- split_hitter_ch[["C"]]
h_category_5_ch <- split_hitter_ch[["1B"]]
h_category_6_ch <- split_hitter_ch[["2B"]]
h_category_7_ch <- split_hitter_ch[["3B"]]
h_category_8_ch <- split_hitter_ch[["SS"]]
h_category_9_ch <- split_hitter_ch[["RF"]]
h_category_10_ch <- split_hitter_ch[["CF"]]
h_category_11_ch <- split_hitter_ch[["LF"]]
d_hitter_data_ch <- split_hitter_ch[["DH"]]

# Defensive:
starting_data_ch <- split_fielder_ch[["SP"]]
b_category_2_ch <- split_fielder_ch[["RP"]]
b_category_3_ch <- split_fielder_ch[["RP/CL"]]
shorts_data_ch <- split_fielder_ch[["SS"]]
```

Tercero, concatenaremos estas bases de datos de acuerdo a los grupos señalados anteriormente

```{r group_concat_ch, include=FALSE}
# All panels:
# Hitters:
# Concatenate the two categories
hitter_data_ch <- rbind(h_category_1_ch, h_category_2_ch, h_category_3_ch, h_category_4_ch,
                        h_category_5_ch, h_category_6_ch, h_category_7_ch, h_category_8_ch,
                        h_category_9_ch, h_category_10_ch, h_category_11_ch)
hitter_data_ch <- unique(hitter_data_ch)

# Fielders:
# Concatenate the two categories
relief_pitcher_data_ch <- rbind(b_category_2_ch, b_category_3_ch)
relief_pitcher_data_ch <- unique(relief_pitcher_data_ch)
```

Procedamos con las estimaciones de forma directa, no conjunta, puesto que tenemos como objetivo probar que hay un aumento en el poder de negociación

```{r hitter_var_list_ch, include=FALSE}
# LIsta de variables acumuladas y anualmente promediadas_
stat_hitter_ch <- list("X_At_bats", "X_At_bats_2",
                        "X_Bateos", "X_Bateos_2",
                        "X_Bateos_promedio", "X_Bateos_promedio_2", 
                        "X_Dobles", "X_Dobles_2",
                        "X_Home_runs", "X_Home_runs_2",
                        "X_Juegos_iniciados", "X_Juegos_iniciados_2",
                        "X_Porcentaje_On_base_plus_slugging", "X_Porcentaje_On_base_plus_slugging_2",
                        "X_Porcentaje_on_base", "X_Porcentaje_on_base_2",
                        "X_Porcentaje_slugging", "X_Porcentaje_slugging_2",
                        "X_Runs_batted_in", "X_Runs_batted_in_2",
                        "X_WAR", "X_WAR_2")

# Add suffix "_t" to each name
stat_hitter_t_ch <- paste0(stat_hitter_ch, "_t")
stat_hitter_t_1_ch <- paste0(stat_hitter_ch, "_t_1")
```

```{r fielder_var_list_ch, include = FALSE}
# LIsta de variables acumuladas y anualmente promediadas_
stat_fielder_ch <- list('X_Bateos_2', 'X_Bateos',
                         'X_Carreras_2', 'X_Carreras_ganadas_2',
                         'X_Carreras_ganadas', 'X_Carreras',
                         'X_Comando_2', 'X_Comando',
                         'X_Control_2', 'X_Control',
                         'X_Dominio_2', 'X_Dominio',
                         'X_ERA_2', 'X_ERA',
                         'X_Inning_pitched_2', 'X_Inning_pitched',
                         'X_Losses_2', 'X_Losses',
                         'X_Strike_outs_2', 'X_Strike_outs',
                         'X_WAR_2', 'X_WAR',
                         'X_WHIP_2', 'X_WHIP',
                         'X_Walks_2', 'X_Walks')

# Add suffix "_t" to each name
stat_fielder_t_ch <- paste0(stat_fielder_ch, "_t")
stat_fielder_t_1_ch <- paste0(stat_fielder_ch, "_t_1")
```

```{r controles_ch, include=FALSE}
# Constroles:
vars  <- 'Y_Sueldo_regular_norm_t ~ Edad_t + Anios_de_contrato_t + team_num_t'
```

```{r hitter_stats_labels_ch, echo=FALSE, eval=TRUE}
hitter_stats_1_ch = c("$Edad_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                       "$X_{AB_{t}}$","$X_{AB_{t-1}}$","$X_{AB^{2}_{t}}$","$X_{AB^{2}_{t-1}}$",
                       "$X_{H_{t}}$","$X_{H_{t-1}}$","$X_{H^{2}_{t}}$","$X_{H^{2}_{t-1}}$",
                       "$X_{BA_{t}}$","$X_{BA_{t-1}}$", "$X_{BA^{2}_{t}}$","$X_{BA^{2}_{t-1}}$",
                       "Agente$_{t}$")
hitter_stats_2_ch = c("$Edad_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                       "$X_{D_{t}}$","$X_{D_{t-1}}$","$X_{D^{2}_{t}}$","$X_{D^{2}_{t-1}}$",
                       "$X_{HR_{t}}$","$X_{HR_{t-1}}$","$X_{HR^{2}_{t}}$","$X_{HR^{2}_{t-1}}$",
                       "$X_{GS_{t}}$","$X_{GS_{t-1}}$", "$X_{GS^{2}_{t}}$","$X_{GS^{2}_{t-1}}$",
                       "Agente$_{t}$")
hitter_stats_3_ch = c("$Edad_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                       "$X_{OPS_{t}}$","$X_{OPS_{t-1}}$","$X_{OPS^{2}_{t}}$","$X_{OPS^{2}_{t-1}}$",
                       "$X_{OBP_{t}}$","$X_{OBP_{t-1}}$","$X_{OBP^{2}_{t}}$","$X_{OBP^{2}_{t-1}}$",
                       "$X_{SLG_{t}}$","$X_{SLG_{t-1}}$", "$X_{SLG^{2}_{t}}$","$X_{SLG^{2}_{t-1}}$",
                       "Agente$_{t}$")
hitter_stats_4_ch = c("$Edad_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                       "$X_{RBI_{t}}$","$X_{RBI_{t-1}}$","$X_{RBI^{2}_{t}}$","$X_{RBI^{2}_{t-1}}$",
                       "$X_{WAR_{t}}$","$X_{WAR_{t-1}}$", "$X_{WAR^{2}_{t}}$","$X_{WAR^{2}_{t-1}}$",
                       "Agente$_{t}$")
hitter_stats_ch <- list(hitter_stats_1_ch,
                         hitter_stats_2_ch,
                         hitter_stats_3_ch,
                         hitter_stats_4_ch)
# Cycles for loop
hitter_rep_ch <- 3
# Stats to show
hitter_stat_num <- 6
```

```{r fielder_stats_labels_ch, echo=FALSE, eval=TRUE}
fielder_stats_1_ch = c("$Edad_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                        "$X_{H^{2}_{t}}$","$X_{H^{2}_{t-1}}$","$X_{H_{t}}$","$X_{H_{t-1}}$",
                        "$X_{R^{2}_{t}}$","$X_{R^{2}_{t-1}}$","$X_{ER^{2}_{t}}$","$X_{ER^{2}_{t-1}}$",
                        "$X_{ER_{t}}$","$X_{ER_{t-1}}$", "$X_{R_{t}}$","$X_{R_{t-1}}$",
                        "Agente$_{t}$")
fielder_stats_2_ch = c("$Edad_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$", 
                        "$X_{Comando^{2}_{t}}$","$X_{Comando^{2}_{t-1}}$","$X_{Comando_{t}}$","$X_{Comando_{t-1}}$",
                        "$X_{Control^{2}_{t}}$","$X_{Control^{2}_{t-1}}$","$Control_{H_{t}}$","$X_{Control_{t-1}}$",
                        "$X_{Dominio^{2}_{t}}$","$X_{Dominio^{2}_{t-1}}$","$X_{Dominio_{t}}$","$X_{Dominio_{t-1}}$",
                        "Agente$_{t}$")
fielder_stats_3_ch = c("$Edad_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$",
                        "$X_{ERA^{2}_{t}}$","$X_{ERA^{2}_{t-1}}$","$X_{ERA_{t}}$","$X_{ERA_{t-1}}$",
                        "$X_{IP^{2}_{t}}$","$X_{IP^{2}_{t-1}}$","$X_{IP_{t}}$","$X_{IP_{t-1}}$",
                        "$X_{L^{2}_{t}}$","$X_{L^{2}_{t-1}}$", "$X_{L_{t}}$","$X_{L_{t-1}}$",
                        "Agente$_{t}$")
fielder_stats_4_ch = c("$Edad_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$",
                        "$X_{SO^{2}_{t}}$","$X_{SO^{2}_{t-1}}$","$X_{SO_{t}}$","$X_{SO_{t-1}}$",
                        "$X_{WAR^{2}_{t}}$","$X_{WAR^{2}_{t-1}}$","$X_{WAR_{t}}$","$X_{WAR_{t-1}}$",
                        "$X_{WHIP^{2}_{t}}$","$X_{WHIP^{2}_{t-1}}$","$X_{WHIP_{t}}$","$X_{WHIP_{t-1}}$",
                        "Agente$_{t}$")
fielder_stats_5_ch = c("$Edad_{t}$" , "Años contrato$_{t}$", "Eqipo$_{t}$",
                        "$X_{BB^{2}_{t}}$","$X_{BB^{2}_{t-1}}$","$X_{BB_{t}}$","$X_{BB_{t-1}}$",
                        "Agente$_{t}$")
fielder_stats_ch <- list(fielder_stats_1_ch,
                          fielder_stats_2_ch,
                          fielder_stats_3_ch,
                          fielder_stats_4_ch,
                          fielder_stats_5_ch)
# Cycles for loop
fielder_rep_ch <- 4
# Stats to show
fielder_stat_num <- 6
```

## Pooling 

### Bateadores

Se obtendrán las estimaciones de las variables referentes a estadísticas deportivas sin controles

```{r hitter_stimation_simple_pooling_ch, echo=FALSE, eval=TRUE}
# Create a model to store the results
hitter_simple_pooling_ch <- list()

# To store the results
hitter_results_simple_pooling_1_ch <- list()
hitter_results_simple_pooling_2_ch <- list()
hitter_results_simple_pooling_3_ch <- list()
hitter_results_simple_pooling_4_ch <- list()
hitter_results_simple_pooling_ch <- list(result_1 = hitter_results_simple_pooling_1_ch,
                                          result_2 = hitter_results_simple_pooling_2_ch,
                                          result_3 = hitter_results_simple_pooling_3_ch,
                                          result_4 = hitter_results_simple_pooling_4_ch)

# Loop over the variables in var_hitter_list
for (j in 1:hitter_rep_ch){
  
  for (i in 1:hitter_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(vars_ms, stat_hitter_t_ch[[i + hitter_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_hitter_t_1_ch[[i + hitter_stat_num*(j - 1)]],
                     sep = " + ")
    
    hitter_simple_pooling_ch[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = hitter_data_ch,
                                                  model = "pooling",
                                                  index = c("id", "Anio_ref"))
        
    hitter_results_simple_pooling_ch[[j]][[i]] <- coeftest(hitter_simple_pooling_ch[[i + hitter_stat_num*(j - 1)]],
                                                        vcov = vcovHC(hitter_simple_pooling_ch[[i + hitter_stat_num*(j - 1)]],
                                                                      type = "HC1",
                                                                      cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(hitter_results_simple_pooling_ch[[j]],
          no.space = TRUE,
          type = "text",
          title = "Bateadores: Modelo Pooling",
          covariate.labels = hitter_stats_ch[[j]])
  
  # For last variables:
  if (j == 3){
    for (i in 1:4){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(vars_ms, stat_hitter_t_ch[[i + hitter_stat_num*(j)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_hitter_t_1_ch[[i + hitter_stat_num*(j)]],
                     sep = " + ")
    
    hitter_simple_pooling_ch[[i + hitter_stat_num*(j)]] <- plm(formula, data = hitter_data_ch,
                                                  model = "pooling",
                                                  index = c("id", "Anio_ref"))
        
    hitter_results_simple_pooling_ch[[4]][[i]] <- coeftest(hitter_simple_pooling_ch[[i + hitter_stat_num*(j)]],
                                                            vcov = vcovHC(hitter_simple_pooling_ch[[i + hitter_stat_num*(j)]],
                                                                          type = "HC1",
                                                                          cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(hitter_results_simple_pooling_ch[[4]],
          no.space = TRUE,
          type = "text",
          title = "Bateadores: Modelo Pooling",
          covariate.labels = hitter_stats_ch[[4]])
  }
}
```

Ahora evaluaremos los cambios estructurales compararemos los modelos estimados para los periodos de cambio en comparación con los primeros dos años de agente libre

### Hitter

```{r hitter_periods_fa, echo=FALSE, eval=TRUE}
# To store results:
hitter_model_pooling_ch <- list()
compare_list <- c("X_Triples_t","X_Triples_2_t")

# Extract the desired substrings using regular expressions and gsub()
hitter_names <- gsub("^X_(.*)_(t)$", "\\1", stat_hitter_t)

# loop over the variables in var_hitter_list
for (i in 1:length(stat_hitter_t)){
  
  # Exclude stats
  if(!(stat_hitter_t[[i]] %in% compare_list)){
    
    # run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(vars_ms, stat_hitter_t[[i]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_hitter_t_1[[i]],
                     sep = " + ")
   
    hitter_model_pooling_ch[[i]] <- plm(formula, data = hitter_data_ch,
                                       model = "pooling",
                                       index = c("id", "Anio_ref"))
    
    # Hausman test:
    print("")
    print(hitter_names[[i]])
    print("Test para cambio estructural entre periodos:")
    print(phtest(hitter_model_pooling_ch[[i]],
                 hitter_model_pooling_fa[[i]]))
  }
}
```

### Starting pitcher

```{r starting_stimation_pooling_ch, echo=FALSE, eval=TRUE}
# Create a model to store the results
fielder_simple_pooling_ch <- list()

# To store the results
fielder_results_simple_pooling_1_ch <- list()
fielder_results_simple_pooling_2_ch <- list()
fielder_results_simple_pooling_3_ch <- list()
fielder_results_simple_pooling_4_ch <- list()
fielder_results_simple_pooling_5_ch <- list()
fielder_results_simple_pooling_ch <- list(result_1 = fielder_results_simple_pooling_1_ch,
                                           result_2 = fielder_results_simple_pooling_2_ch,
                                           result_3 = fielder_results_simple_pooling_3_ch,
                                           result_4 = fielder_results_simple_pooling_4_ch,
                                           result_5 = fielder_results_simple_pooling_5_ch)

# Loop over the variables in var_hitter_list
for (j in 1:fielder_rep_ch){
  
  for (i in 1:fielder_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(vars_fe, stat_fielder_t_ch[[i + fielder_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_fielder_t_1_ch[[i + fielder_stat_num*(j - 1)]],
                     sep = " + ")
    
    fielder_simple_pooling_ch[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = starting_data_ch,
                                                                    model = "pooling",
                                                                    index = c("id", "Anio_ref"))
        
    fielder_results_simple_pooling_ch[[j]][[i]] <- coeftest(fielder_simple_pooling_ch[[i + fielder_stat_num*(j - 1)]],
                                                             vcov = vcovHC(fielder_simple_pooling_ch[[i + fielder_stat_num*(j - 1)]],
                                                                           type = "HC1",
                                                                           cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(fielder_results_simple_pooling_ch[[j]],
            no.space = TRUE,
            type = "text",
            title = "Lanzadores Iniciales: Modelo Pooling",
            covariate.labels = fielder_stats_ch[[j]])
  
  # For last variables:
  if (j == 4){
    for (i in 1:2){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(vars_fe, stat_fielder_t_ch[[i + fielder_stat_num*(j)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_fielder_t_1_ch[[i + fielder_stat_num*(j)]],
                     sep = " + ")
    
    fielder_simple_pooling_ch[[i + fielder_stat_num*(j)]] <- plm(formula, data = starting_data_ch,
                                                                  model = "pooling",
                                                                  index = c("id", "Anio_ref"))
        
    fielder_results_simple_pooling_ch[[5]][[i]] <- coeftest(fielder_simple_pooling_ch[[i + fielder_stat_num*(j)]],
                                                            vcov = vcovHC(fielder_simple_pooling_ch[[i + fielder_stat_num*(j)]],
                                                                          type = "HC1",
                                                                          cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(fielder_results_simple_pooling_ch[[5]],
          no.space = TRUE,
          type = "text",
          title = "Bateadores: Modelo Pooling",
          covariate.labels = fielder_stats_ch[[5]])
  }
}
```

```{r fielder_periods_fa, echo=FALSE, eval=TRUE}
# To store results:
fielder_model_pooling_ch <- list()
compare_list <- c("X_Saves_t","X_Saves_2_t")

# Extract the desired substrings using regular expressions and gsub()
fielder_names <- gsub("^X_(.*)_(t)$", "\\1", stat_fielder_t)

# loop over the variables in var_hitter_list
for (i in 1:length(stat_fielder_t)){
  
  # Exclude stats
  if(!(stat_fielder_t[[i]] %in% compare_list)){
    
    # run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(vars_ms, stat_fielder_t[[i]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_fielder_t_1[[i]],
                     sep = " + ")
   
    fielder_model_pooling_ch[[i]] <- plm(formula, data = starting_data_ch,
                                         model = "pooling",
                                         index = c("id", "Anio_ref"))
    
    # Hausman test:
    print("")
    print(fielder_names[[i]])
    print("Test para cambio estructural entre periodos:")
    print(phtest(fielder_model_pooling_ch[[i]],
                 fielder_model_pooling_fa[[i]]))
  }
}
```

## Efectos aleatorios

Por definición, necesitamos más de un periodo de observación. Por lo tanto, no obtendremos dicho modelo por esa restricción.

## Efectos aleatorios

Son equivalentes al pooling debido a que solo obtenemos la estimación para un periodo.

## First Differences

Presenta las mismas restricciones que el estimador *within*.