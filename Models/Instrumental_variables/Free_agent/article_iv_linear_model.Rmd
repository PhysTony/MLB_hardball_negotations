---
title: "Cambio estructural"
author: "Antonio Huerta Montellano"
date: "15 de junio del 2022"
output:
  pdf_document: 
    fig_caption: yes
    latex_engine: xelatex
    keep_tex: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Importando las librerías:
```{r message=FALSE, warning=FALSE, include=FALSE}
library(wooldridge)
library(tidyverse)
library(knitr)
library(readxl)
library(dplyr)
library(ggplot2)
library(coefplot)
library(data.table)
library(pacman)
library(tinytex)
library(AER)
library(car)
library(cragg)
library(tidyr)
options(scipen = 999)
library(tidyverse)
library(stargazer)
library(readxl)
library(dplyr)
library(tidyr)
library(haven)
library(lmtest)
library(sandwich)
library(gap)
library(quantmod)
library(fastDummies)
```

Veamos cuál es el directorio de trabajo
```{r setwd}
getwd()
```

Cambiemos el directorio de trabajo y carguemos las bases de datos para el modelo lineal en el mismo chunk:

```{r base_datos}
setwd("~/Documentos/Github/Proyectos/MLB_HN/")
free_agents <- read.csv('Data/New_Data/Models/Article/article_iv_linear_regression_fa.csv')
```
Observemos el contenido de las bases de datos de los agentes libres:
```{r fa_base_datos_head}
head(free_agents)
```

\section{Dummificación}

Creemos las variables dummy correspondientes a las variables categóricas de la posición del jugador y al estad

```{r fa_model}
dummy <- dummy_cols(free_agents, select_columns = c('Posicion', 'Equipo'),
                    remove_selected_columns = TRUE)
```

Notemos que ahora hay muchas columnas debido a la dummificación y la gran cantidad de categorías tanto para la posición que puede ocupar un jugador como para el equipo al que pertencen (29):

```{r dummy_view}
head(dummy)
```

\section{Creación del modelo}

Para ello y evitar errores, lo haremos con los nombres explícitos, obtengamos los nombres de las columnas
```{r data_names}
colnames(dummy)
```

Cambiemos el nombre de la columna "Posicion_RP/CL" por "Posicion_RP_CL" para evitar problemas en los algoritmos:
```{r new_name}
names(dummy)[names(dummy) == 'Posicion_RP/CL'] <- 'Posicion_RP_CL'
```


```{r}
formula_iv <- Y ~ X | Equipos_estado + Posicion_1B + Posicion_2B + Posicion_3B + Posicion_C + Posicion_CF + Posicion_DH + Posicion_LF + Posicion_RF + Posicion_RP + Posicion_RP_CL +  Posicion_SP + Posicion_SS + Equipo_ARI + Equipo_ATL + Equipo_BAL + Equipo_BOS + Equipo_CHC + Equipo_CHW + Equipo_CIN +  Equipo_COL + Equipo_DET + Equipo_HOU +  Equipo_KC  +  Equipo_LAA +  Equipo_LAD +  Equipo_MIA + Equipo_MIL + Equipo_MIN +  Equipo_NYM +  Equipo_NYY +   Equipo_OAK + Equipo_PHI + Equipo_PIT +   Equipo_SD  +  Equipo_SEA +  Equipo_SF  +  Equipo_STL + Equipo_TB  +  Equipo_TEX + Equipo_TOR + Equipo_WSH 
iv_model <- ivreg(formula_iv, data = dummy)
summary(iv_model, diagnostics=TRUE)
```
En comparación con el modelo sin isntrumentos -donde se obtuvo un $p-value = 0.738$-, aquí mejoró dicho valor. Sin embargo, no es suficiente para que la variable $X$ se estadísticamente significativa para el modelo. También dio positivo para la prueba de instrumentos débiles.