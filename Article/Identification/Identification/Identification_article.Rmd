---
title: "Dynamic Model - Identification"
author: "Antonio Huerta Montellano"
date: "\today"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = TRUE)
opts_chunk$set(comment = NA)
options(warn = FALSE) # ignore warnings
```

```{r libraries, include=FALSE}
library(lmtest) # for robust standard errors
library(dplyr) # for group_by function
library(ggplot2) # for better plots
library(dplyr) # for data managment
library(clubSandwich) # Grouped errors
library(sandwich) # MOre error options
library(tidyr) # Datframes manipulation
library(stargazer) # For output formats
library(lubridate)
library(plm)
library(car)
```

```{r import_panel, include = FALSE, warning = FALSE}
# Definir la ruta base y la ruta de importación
base_path <- "C:/Users/metal/Documents/Github/MLB_hardball_negotations/"
import_path <- paste0(base_path, "Article/DataModel/")

# Leer los archivos CSV
hitters_panel <- read.csv(paste0(import_path, "hitter_model.csv"))
fielders_panel <- read.csv(paste0(import_path, "fielder_model.csv"))
hitters_fd_panel <- read.csv(paste0(import_path, "hitter_model_fd.csv"))
fielders_fd_panel <- read.csv(paste0(import_path, "fielder_model_fd.csv"))
```

```{r stat_stimations, include = FALSE, warning = FALSE}
# LIsta de variables acumuladas y anualmente promediadas_
stat_hitter <- list("X_At_bats", "X_At_bats_2",
                    "X_Bateos", "X_Bateos_2",
                    "X_Bateos_promedio", "X_Bateos_promedio_2", 
                    "X_Dobles", "X_Dobles_2",
                    "X_Home_runs", "X_Home_runs_2",
                    "X_Juegos_iniciados", "X_Juegos_iniciados_2",
                    "X_Porcentaje_On_base_plus_slugging", "X_Porcentaje_On_base_plus_slugging_2",
                    "X_Porcentaje_on_base", "X_Porcentaje_on_base_2",
                    "X_Porcentaje_slugging", "X_Porcentaje_slugging_2",
                    "X_Runs_batted_in", "X_Runs_batted_in_2",
                    "X_Triples", "X_Triples_2",
                    "X_WAR", "X_WAR_2")

# Add suffix "_t" to each name
stat_hitter_t <- paste0(stat_hitter, "_t")
stat_hitter_t_1 <- paste0(stat_hitter, "_t_1")

# LIsta de variables acumuladas y anualmente promediadas_
stat_fielder <- list('X_Bateos_2', 'X_Bateos',
                     'X_Carreras_2', 'X_Carreras_ganadas_2',
                     'X_Carreras_ganadas', 'X_Carreras',
                     'X_Comando_2', 'X_Comando',
                     'X_Control_2', 'X_Control',
                     'X_Dominio_2', 'X_Dominio',
                     'X_ERA_2', 'X_ERA',
                     'X_Inning_pitched_2', 'X_Inning_pitched',
                     'X_Losses_2', 'X_Losses',
                     'X_Saves_2', 'X_Saves',
                     'X_Strike_outs_2', 'X_Strike_outs',
                     'X_WAR_2', 'X_WAR',
                     'X_WHIP_2', 'X_WHIP',
                     'X_Walks_2', 'X_Walks',
                     'X_Wins_2', 'X_Wins')

# Add suffix "_t" to each name
stat_fielder_t <- paste0(stat_fielder, "_t")
stat_fielder_t_1 <- paste0(stat_fielder, "_t_1")
```

```{r stat_latex, echo=FALSE, include=FALSE}
# Control variables:
control_vars  <- 'Y ~ Edad_t_2 + Anios_de_contrato_t_2 + I(team_num_t^2) + X_Ingresos_equipo_t + X_Ingresos_equipo_t_1 - 1'
control_vars_1  <- 'Y ~ Edad_t_2 + Anios_de_contrato_t_2 + I(team_num_t^2) + X_Ingresos_equipo_t + X_Ingresos_equipo_t_1 - 1'

hitter_stats_1 = c("Edad$_{t}^2$", "Años contrato$_{t}^2$",
                   "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                   "$X_{AB_{t}}$","$X_{AB_{t-1}}$","$X_{AB^{2}_{t}}$","$X_{AB^{2}_{t-1}}$",
                   "$X_{H_{t}}$","$X_{H_{t-1}}$","$X_{H^{2}_{t}}$","$X_{H^{2}_{t-1}}$",
                   "$X_{BA_{t}}$","$X_{BA_{t-1}}$", "$X_{BA^{2}_{t}}$","$X_{BA^{2}_{t-1}}$",
                   "Agente$_{t}$")
hitter_stats_2 = c("Edad$_{t}^2$", "Años contrato$_{t}^2$",
                   "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                   "$X_{D_{t}}$","$X_{D_{t-1}}$","$X_{D^{2}_{t}}$","$X_{D^{2}_{t-1}}$",
                   "$X_{HR_{t}}$","$X_{HR_{t-1}}$","$X_{HR^{2}_{t}}$","$X_{HR^{2}_{t-1}}$",
                   "$X_{GS_{t}}$","$X_{GS_{t-1}}$", "$X_{GS^{2}_{t}}$","$X_{GS^{2}_{t-1}}$",
                   "Agente$_{t}$")
hitter_stats_3 = c("Edad$_{t}^2$" , "Años contrato$_{t}^2$",
                   "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                   "$X_{OPS_{t}}$","$X_{OPS_{t-1}}$","$X_{OPS^{2}_{t}}$","$X_{OPS^{2}_{t-1}}$",
                   "$X_{OBP_{t}}$","$X_{OBP_{t-1}}$","$X_{OBP^{2}_{t}}$","$X_{OBP^{2}_{t-1}}$",
                   "$X_{SLG_{t}}$","$X_{SLG_{t-1}}$", "$X_{SLG^{2}_{t}}$","$X_{SLG^{2}_{t-1}}$",
                   "Agente$_{t}$")
hitter_stats_4 = c("Edad$_{t}^2$" , "Años contrato$_{t}^2$",
                   "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                   "$X_{RBI_{t}}$","$X_{RBI_{t-1}}$","$X_{RBI^{2}_{t}}$","$X_{RBI^{2}_{t-1}}$",
                   "$X_{T_{t}}$","$X_{T_{t-1}}$","$X_{T^{2}_{t}}$","$X_{T^{2}_{t-1}}$",
                   "$X_{WAR_{t}}$","$X_{WAR_{t-1}}$", "$X_{WAR^{2}_{t}}$","$X_{WAR^{2}_{t-1}}$",
                   "Agente$_{t}$")
hitter_stats <- list(hitter_stats_1,
                     hitter_stats_2,
                     hitter_stats_3,
                     hitter_stats_4)

# Cycles for loop
hitter_rep <- 4
# Stats to show
hitter_stat_num <- 6

hitter_stats_long <- list(c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{AB_{t}}$","$X_{AB_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{AB^{2}_{t}}$","$X_{AB^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{H_{t}}$","$X_{H_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{H^{2}_{t}}$","$X_{H^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{BA_{t}}$","$X_{BA_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{BA^{2}_{t}}$","$X_{BA^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{D_{t}}$","$X_{D_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{D^{2}_{t}}$","$X_{D^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{HR_{t}}$","$X_{HR_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{HR^{2}_{t}}$","$X_{HR^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{GS_{t}}$","$X_{GS_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{GS^{2}_{t}}$","$X_{GS^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{OPS_{t}}$","$X_{OPS_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{OPS^{2}_{t}}$","$X_{OPS^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{OBP_{t}}$","$X_{OBP_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{OBP^{2}_{t}}$","$X_{OBP^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{SLG_{t}}$","$X_{SLG_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{SLG^{2}_{t}}$","$X_{SLG^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{RBI_{t}}$","$X_{RBI_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{RBI^{2}_{t}}$","$X_{RBI^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{T_{t}}$","$X_{T_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{T^{2}_{t}}$","$X_{T^{2}_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{WAR_{t}}$","$X_{WAR_{t-1}}$",
                            "Agente$_{t}$"),
                          c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                            "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                            "$X_{WAR^{2}_{t}}$","$X_{WAR^{2}_{t-1}}$",
                            "Agente$_{t}$")
                          )

fielder_stats_1 = c("Edad$_{t}^2$" , "Años contrato$_{t}^2$",
                    "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                    "$X_{H^{2}_{t}}$","$X_{H^{2}_{t-1}}$","$X_{H_{t}}$","$X_{H_{t-1}}$",
                    "$X_{R^{2}_{t}}$","$X_{R^{2}_{t-1}}$","$X_{ER^{2}_{t}}$","$X_{ER^{2}_{t-1}}$",
                    "$X_{ER_{t}}$","$X_{ER_{t-1}}$", "$X_{R_{t}}$","$X_{R_{t-1}}$",
                    "Agente$_{t}$")
fielder_stats_2 = c("Edad$_{t}^2$" , "Años contrato$_{t}^2$",
                    "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                    "$X_{Comando^{2}_{t}}$","$X_{Comando^{2}_{t-1}}$",
                    "$X_{Comando_{t}}$","$X_{Comando_{t-1}}$",
                    "$X_{Control^{2}_{t}}$","$X_{Control^{2}_{t-1}}$",
                    "$Control_{H_{t}}$","$X_{Control_{t-1}}$",
                    "$X_{Dominio^{2}_{t}}$","$X_{Dominio^{2}_{t-1}}$",
                    "$X_{Dominio_{t}}$","$X_{Dominio_{t-1}}$",
                    "Agente$_{t}$")
fielder_stats_3 = c("Edad$_{t}^2$" , "Años contrato$_{t}^2$",
                    "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                    "$X_{ERA^{2}_{t}}$","$X_{ERA^{2}_{t-1}}$",
                    "$X_{ERA_{t}}$","$X_{ERA_{t-1}}$",
                    "$X_{IP^{2}_{t}}$","$X_{IP^{2}_{t-1}}$",
                    "$X_{IP_{t}}$","$X_{IP_{t-1}}$",
                    "$X_{L^{2}_{t}}$","$X_{L^{2}_{t-1}}$",
                    "$X_{L_{t}}$","$X_{L_{t-1}}$",
                    "Agente$_{t}$")
fielder_stats_4 = c("$Edad_{t}$" , "Años contrato$_{t}^2$",
                    "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                    "$X_{S^{2}_{t}}$","$X_{S^{2}_{t-1}}$",
                    "$X_{S_{t}}$","$X_{S_{t-1}}$",
                    "$X_{SO^{2}_{t}}$","$X_{SO^{2}_{t-1}}$",
                    "$X_{SO_{t}}$","$X_{SO_{t-1}}$",
                    "$X_{WAR^{2}_{t}}$","$X_{WAR^{2}_{t-1}}$",
                    "$X_{WAR_{t}}$","$X_{WAR_{t-1}}$",
                    "Agente$_{t}$")
fielder_stats_5 = c("Edad$_{t}^2$" , "Años contrato$_{t}^2$",
                    "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                    "$X_{WHIP^{2}_{t}}$","$X_{WHIP^{2}_{t-1}}$",
                    "$X_{WHIP_{t}}$","$X_{WHIP_{t-1}}$",
                    "$X_{BB^{2}_{t}}$","$X_{BB^{2}_{t-1}}$",
                    "$X_{BB_{t}}$","$X_{BB_{t-1}}$",
                    "$X_{W^{2}_{t}}$","$X_{W^{2}_{t-1}}$",
                    "$X_{W_{t}}$","$X_{W_{t-1}}$",
                    "Agente$_{t}$")
fielder_stats <- list(fielder_stats_1,
                      fielder_stats_2,
                      fielder_stats_3,
                      fielder_stats_4,
                      fielder_stats_5)
# Cycles for loop
fielder_rep <- 5
# Stats to show
fielder_stat_num <- 6

fielder_stats_long <- list(c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{H^{2}_{t}}$","$X_{H^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{H_{t}}$","$X_{H_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{R^{2}_{t}}$","$X_{R^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{ER^{2}_{t}}$","$X_{ER^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{ER_{t}}$","$X_{ER_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{R_{t}}$","$X_{R_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{Comando^{2}_{t}}$","$X_{Comando^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{Comando_{t}}$","$X_{Comando_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{Control^{2}_{t}}$","$X_{Control^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{Control_{t}}$","$X_{Control_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{Dominio^{2}_{t}}$","$X_{Dominio^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{Dominio_{t}}$","$X_{Dominio_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{ERA^{2}_{t}}$","$X_{ERA^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{ERA_{t}}$","$X_{ERA_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{IP^{2}_{t}}$","$X_{IP^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{IP_{t}}$","$X_{IP_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{L^{2}_{t}}$","$X_{L^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{DL_{t}}$","$X_{L_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{S^{2}_{t}}$","$X_{S^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{S_{t}}$","$X_{S_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{SO^{2}_{t}}$","$X_{SO^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{SO_{t}}$","$X_{SO_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{WAR^{2}_{t}}$","$X_{WAR^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{WAR_{t}}$","$X_{WAR_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{WHIP^{2}_{t}}$","$X_{WHIP^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{WHIP_{t}}$","$X_{WHIP_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{BB^{2}_{t}}$","$X_{BB^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{BB_{t}}$","$X_{BB_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{W^{2}_{t}}$","$X_{W^{2}_{t-1}}$",
                              "Agente$_{t}$"),
                            c("Edad$_{t}^2$","Años contrato$_{t}^2$",
                              "Equipo$_{t}^2$","X_Ingresos_equipo$_{t}$","X_Ingresos_equipo$_{t-1}$",
                              "$X_{W_{t}}$","$X_{W_{t-1}}$",
                              "Agente$_{t}$")
                            )
```

```{r general_variables, include=FALSE}
# Lista de bases de datos
hitter_data_list <- list(hitters_panel, hitters_panel, hitters_panel, hitters_fd_panel)
fielder_data_list <- list(fielders_panel, fielders_panel, fielders_panel, fielders_fd_panel)

# Lista de modelos a aplicar
model_list <- list("pooling", "within", "random", "random")

# Lista de nombres para imprimri
name_list <- list("Pooling", "Within", "RE", "FD")

```


# Identificación Simple

En este caso, solo haremos la identificación con las variables relacionadas a los ingresos salariales del equipo, es decir, sin controles. Se irá refinando conforme la significancia de las variables.

Solo conservaremos las variables que posean significancia estadística, el resto se omitirán del modelo en los procesos de refinamiento para evitar problemas de variables innecesarias.

## Bateadores

```{r simple_identification_hitters_1, echo=FALSE, warning=FALSE}
# Inicializar una lista para almacenar los modelos
hitter_simple_stimation_1 <- list()

# Inicializar una lista para almacenar los resultados
hitter_simple_stimation_results_1 <- list()

# Fórmula para el modelo
formula_simple_1 <- 'Y ~ X_Ingresos_equipo_t + X_Ingresos_equipo_t_1 - 1'

# Iterar sobre cada base de datos y cada modelo
for (i in 1:4) {
  # Estimar el modelo usando plm
  hitter_simple_stimation_1[[length(hitter_simple_stimation_1) + 1]] <- plm(formula_simple_1,
                                                                            data = hitter_data_list[[i]],
                                                                            model = model_list[[i]],
                                                                            index = c("id", "Anio_ref"))
  # To store the results
  hitter_simple_stimation_results_1[[length(hitter_simple_stimation_results_1) + 1]] <- coeftest(hitter_simple_stimation_1[[length(hitter_simple_stimation_1)]],
      vcov = vcovHC(hitter_simple_stimation_1[[length(hitter_simple_stimation_1)]],
                                                type = "HC1",
                                                cluster = "group"))
}

# Print the third block of results
stargazer(hitter_simple_stimation_1,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Bateadores: Comparación de los modelos",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"),
         covariate.labels = c("X$_{tearev}_{t}$", "X$_{tearev}_{t-1}$"))
```

Quitaremos la variable del periodo $t$

```{r simple_identification_hitters_2, echo=FALSE, warning=FALSE}
# Inicializar una lista para almacenar los modelos
hitter_simple_stimation_2 <- list()

# Inicializar una lista para almacenar los resultados
hitter_simple_stimation_results_2 <- list()

# Fórmula para el modelo
formula_simple_2 <- 'Y ~ X_Ingresos_equipo_t_1 - 1'

# Iterar sobre cada base de datos y cada modelo
for (i in 1:4) {
  # Estimar el modelo usando plm
  hitter_simple_stimation_2[[length(hitter_simple_stimation_2) + 1]] <- plm(formula_simple_2,
                                                                            data = hitter_data_list[[i]],
                                                                            model = model_list[[i]],
                                                                            index = c("id", "Anio_ref"))
  # To store the results
  hitter_simple_stimation_results_2[[length(hitter_simple_stimation_results_2) + 1]] <- coeftest(hitter_simple_stimation_2[[length(hitter_simple_stimation_2)]],
      vcov = vcovHC(hitter_simple_stimation_2[[length(hitter_simple_stimation_2)]],
                                                type = "HC1",
                                                cluster = "group"))
}

# Print the third block of results
stargazer(hitter_simple_stimation_2,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Bateadores: Comparación de los modelos",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"),
         covariate.labels = c("X$_{tearev}_{t-1}$"))
```

## Lanzadores Iniciales (Starting fielders)

```{r simple_identification_fielders_1, echo=FALSE, warning=FALSE}
# Inicializar una lista para almacenar los modelos
fielder_simple_stimation_1 <- list()

# Inicializar una lista para almacenar los resultados
fielder_simple_stimation_results_1 <- list()

# Iterar sobre cada base de datos y cada modelo
for (i in 1:4) {
  # Estimar el modelo usando plm
  fielder_simple_stimation_1[[length(fielder_simple_stimation_1) + 1]] <- plm(formula_simple_1,
                                                                            data = fielder_data_list[[i]],
                                                                            model = model_list[[i]],
                                                                            index = c("id", "Anio_ref"))
  # Para almacenar los resultados
  fielder_simple_stimation_results_1[[length(fielder_simple_stimation_results_1) + 1]] <- coeftest(fielder_simple_stimation_1[[length(fielder_simple_stimation_1)]],
      vcov = vcovHC(fielder_simple_stimation_1[[length(fielder_simple_stimation_1)]],
                                                type = "HC1",
                                                cluster = "group"))
}

# Imprimir el tercer bloque de resultados
stargazer(fielder_simple_stimation_1,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Lanzadores: Comparación de los modelos",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"),
         covariate.labels = c("X$_{tearev}_{t}$", "X$_{tearev}_{t-1}$"))

```

En este caso, la variable innecesaria corresponde a la variable rezagada.

```{r simple_identification_fielders_2, echo=FALSE, warning=FALSE}
# Inicializar una lista para almacenar los modelos
fielder_simple_stimation_2 <- list()

# Inicializar una lista para almacenar los resultados
fielder_simple_stimation_results_2 <- list()

# Fórmula para el modelo
formula_simple_3 <- 'Y ~ X_Ingresos_equipo_t - 1'

# Iterar sobre cada base de datos y cada modelo
for (i in 1:4) {
  # Estimar el modelo usando plm
  fielder_simple_stimation_2[[length(fielder_simple_stimation_2) + 1]] <- plm(formula_simple_3,
                                                                            data = fielder_data_list[[i]],
                                                                            model = model_list[[i]],
                                                                            index = c("id", "Anio_ref"))
  # Para almacenar los resultados
  fielder_simple_stimation_results_2[[length(fielder_simple_stimation_results_2) + 1]] <- coeftest(fielder_simple_stimation_2[[length(fielder_simple_stimation_2)]],
      vcov = vcovHC(fielder_simple_stimation_2[[length(fielder_simple_stimation_2)]],
                                                type = "HC1",
                                                cluster = "group"))
}

# Imprimir el tercer bloque de resultados
stargazer(fielder_simple_stimation_2,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Lanzadores: Comparación de los modelos",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"),
         covariate.labels = c("X$_{tearev}_{t}$"))

```

# Identificación con Controles Generales

Ahora, realizaremos las estimaciones del modelo empleando controles concernientes a aspectos generales de los beisbolistas, sin particularizar en la posición que ocupan en el partido.

## Bateadores

```{r general_identification_hitters_1, echo=FALSE, warning=FALSE}
# Inicializar una lista para almacenar los modelos
hitter_general_stimation_1 <- list()

# Inicializar una lista para almacenar los resultados
hitter_general_stimation_results_1 <- list()

# Fórmula para el modelo
formula <- 'Y ~ Edad_t_2 + Anios_de_contrato_t_2 + I(team_num_t^2) + X_Ingresos_equipo_t_1 - 1'

# Iterar sobre cada base de datos y cada modelo
for (i in 1:4) {
  # Estimar el modelo usando plm
  hitter_general_stimation_1[[length(hitter_general_stimation_1) + 1]] <- plm(formula_simple_1,
                                                                            data = hitter_data_list[[i]],
                                                                            model = model_list[[i]],
                                                                            index = c("id", "Anio_ref"))
  # To store the results
  hitter_general_stimation_results_1[[length(hitter_general_stimation_results_1) + 1]] <- coeftest(hitter_general_stimation_1[[length(hitter_general_stimation_1)]],
      vcov = vcovHC(hitter_general_stimation_1[[length(hitter_general_stimation_1)]],
                                                type = "HC1",
                                                cluster = "group"))
}

# Print the third block of results
stargazer(hitter_general_stimation_1,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Bateadores: Comparación de los modelos",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"),
         covariate.labels = c("Edad$^{2}_{t}$","Años Contrato$^{2}_{t}$", "Equipo$^{2}_{t}$",
                              "X$_{tearev}_{t}$", "X$_{tearev}_{t-1}$"))

```








```{r hitter_stimation_simple_pooling, echo=FALSE, eval=TRUE}
# Create a model to store the results
hitter_simple_pooling <- list()

# To store the results
hitter_results_simple_pooling_1 <- list()
hitter_results_simple_pooling_2 <- list()
hitter_results_simple_pooling_3 <- list()
hitter_results_simple_pooling_4 <- list()
hitter_results_simple_pooling <- list(result_1 = hitter_results_simple_pooling_1,
                                      result_2 = hitter_results_simple_pooling_2,
                                      result_3 = hitter_results_simple_pooling_3,
                                      result_4 = hitter_results_simple_pooling_4)

# Loop over the variables in var_hitter_list
for (j in 1:hitter_rep){
  
  for (i in 1:hitter_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(control_vars, stat_hitter_t[[i + hitter_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_hitter_t_1[[i + hitter_stat_num*(j - 1)]],
                     sep = " + ")
    
    hitter_simple_pooling[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = hitter_data,
                                                  model = "pooling",
                                                  index = c("id", "Anio_ref"))
        
    hitter_results_simple_pooling[[j]][[i]] <- coeftest(hitter_simple_pooling[[i + hitter_stat_num*(j - 1)]],
                                                        vcov = vcovHC(hitter_simple_pooling[[i + hitter_stat_num*(j - 1)]],
                                                                      type = "HC1",
                                                                      cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(hitter_results_simple_pooling[[j]],
          no.space = TRUE,
          type = "latex",
          title = "Bateadores: Modelo Pooling",
          covariate.labels = hitter_stats[[j]])
}
```

### Starting pitcher

```{r starting_stimation_pooling, echo=FALSE, eval=TRUE}
# Create a model to store the results
fielder_simple_pooling <- list()

# To store the results
fielder_results_simple_pooling_1 <- list()
fielder_results_simple_pooling_2 <- list()
fielder_results_simple_pooling_3 <- list()
fielder_results_simple_pooling_4 <- list()
fielder_results_simple_pooling_5 <- list()
fielder_results_simple_pooling <- list(result_1 = fielder_results_simple_pooling_1,
                                       result_2 = fielder_results_simple_pooling_2,
                                       result_3 = fielder_results_simple_pooling_3,
                                       result_4 = fielder_results_simple_pooling_4,
                                       result_5 = fielder_results_simple_pooling_5)

# Loop over the variables in var_hitter_list
for (j in 1:fielder_rep){
  
  for (i in 1:fielder_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(control_vars, stat_fielder_t[[i + fielder_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_fielder_t_1[[i + fielder_stat_num*(j - 1)]],
                     sep = " + ")
    
    fielder_simple_pooling[[i + fielder_stat_num*(j - 1)]] <- plm(formula, data = starting_data,
                                                  model = "pooling",
                                                  index = c("id", "Anio_ref"))
        
    fielder_results_simple_pooling[[j]][[i]] <- coeftest(fielder_simple_pooling[[i + fielder_stat_num*(j - 1)]],
                                                         vcov = vcovHC(fielder_simple_pooling[[i + fielder_stat_num*(j - 1)]],
                                                                       type = "HC1",
                                                                       cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(fielder_results_simple_pooling[[j]],
          no.space = TRUE,
          type = "latex",
          title = "Lanzadores Iniciales: Modelo Pooling",
          covariate.labels = fielder_stats[[j]])
}
```

## Efectos fijos

### Bateadores

Se obtendrán las estimaciones de las variables referentes a estadísticas deportivas sin controles

```{r hitter_stimation_simple_within, echo=FALSE, eval=TRUE}
# Create a model to store the results
hitter_simple_within <- list()

# To store the results
hitter_results_simple_within_1 <- list()
hitter_results_simple_within_2 <- list()
hitter_results_simple_within_3 <- list()
hitter_results_simple_within_4 <- list()
hitter_results_simple_within <- list(result_1 = hitter_results_simple_within_1,
                                      result_2 = hitter_results_simple_within_2,
                                      result_3 = hitter_results_simple_within_3,
                                      result_4 = hitter_results_simple_within_4)

# Loop over the variables in var_hitter_list
for (j in 1:hitter_rep){
  
  for (i in 1:hitter_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(control_vars, stat_hitter_t[[i + hitter_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_hitter_t_1[[i + hitter_stat_num*(j - 1)]],
                     sep = " + ")
    
    hitter_simple_within[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = hitter_data,
                                                  model = "within",
                                                  index = c("id", "Anio_ref"))
        
    hitter_results_simple_within[[j]][[i]] <- coeftest(hitter_simple_within[[i + hitter_stat_num*(j - 1)]],
                                                        vcov = vcovHC(hitter_simple_within[[i + hitter_stat_num*(j - 1)]],
                                                                      type = "HC1",
                                                                      cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(hitter_results_simple_within[[j]],
          no.space = TRUE,
          type = "latex",
          title = "Bateadores: Estimador Within",
          covariate.labels = hitter_stats[[j]])
}
```

### Starting pitcher

```{r starting_stimation_within, echo=FALSE, eval=TRUE}
# Create a model to store the results
fielder_simple_within <- list()

# To store the results
fielder_results_simple_within_1 <- list()
fielder_results_simple_within_2 <- list()
fielder_results_simple_within_3 <- list()
fielder_results_simple_within_4 <- list()
fielder_results_simple_within_5 <- list()
fielder_results_simple_within <- list(result_1 = fielder_results_simple_within_1,
                                       result_2 = fielder_results_simple_within_2,
                                       result_3 = fielder_results_simple_within_3,
                                       result_4 = fielder_results_simple_within_4,
                                       result_5 = fielder_results_simple_within_5)

# Loop over the variables in var_hitter_list
for (j in 1:fielder_rep){
  
  for (i in 1:fielder_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(control_vars, stat_fielder_t[[i + fielder_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_fielder_t_1[[i + fielder_stat_num*(j - 1)]],
                     sep = " + ")
    
    fielder_simple_within[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = starting_data,
                                                  model = "within",
                                                  index = c("id", "Anio_ref"))
        
    fielder_results_simple_within[[j]][[i]] <- coeftest(fielder_simple_within[[i + fielder_stat_num*(j - 1)]],
                                                         vcov = vcovHC(fielder_simple_within[[i + fielder_stat_num*(j - 1)]],
                                                                       type = "HC1",
                                                                       cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(fielder_results_simple_within[[j]],
          no.space = TRUE,
          type = "latex",
          title = "Lanzadores Iniciales: Estimador Within",
          covariate.labels = fielder_stats[[j]])
}
```

## Efectos aleatorios

### Bateadores

Se obtendrán las estimaciones de las variables referentes a estadísticas deportivas sin controles

```{r hitter_stimation_simple_random, echo=FALSE, eval=TRUE}
# Create a model to store the results
hitter_simple_random <- list()

# To store the results
hitter_results_simple_random_1 <- list()
hitter_results_simple_random_2 <- list()
hitter_results_simple_random_3 <- list()
hitter_results_simple_random_4 <- list()
hitter_results_simple_random <- list(result_1 = hitter_results_simple_random_1,
                                      result_2 = hitter_results_simple_random_2,
                                      result_3 = hitter_results_simple_random_3,
                                      result_4 = hitter_results_simple_random_4)

# Loop over the variables in var_hitter_list
for (j in 1:hitter_rep){
  
  for (i in 1:hitter_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(control_vars, stat_hitter_t[[i + hitter_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_hitter_t_1[[i + hitter_stat_num*(j - 1)]],
                     sep = " + ")
    
    hitter_simple_random[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = hitter_data,
                                                  model = "random",
                                                  index = c("id", "Anio_ref"))
        
    hitter_results_simple_random[[j]][[i]] <- coeftest(hitter_simple_random[[i + hitter_stat_num*(j - 1)]],
                                                        vcov = vcovHC(hitter_simple_random[[i + hitter_stat_num*(j - 1)]],
                                                                      type = "HC1",
                                                                      cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(hitter_results_simple_random[[j]],
          no.space = TRUE,
          type = "latex",
          title = "Bateadores: Efectos Aleatorios",
          covariate.labels = hitter_stats[[j]])
}
```

### Starting pitcher

```{r starting_stimation_random, echo=FALSE, eval=TRUE}
# Create a model to store the results
fielder_simple_random <- list()

# To store the results
fielder_results_simple_random_1 <- list()
fielder_results_simple_random_2 <- list()
fielder_results_simple_random_3 <- list()
fielder_results_simple_random_4 <- list()
fielder_results_simple_random_5 <- list()
fielder_results_simple_random <- list(result_1 = fielder_results_simple_random_1,
                                       result_2 = fielder_results_simple_random_2,
                                       result_3 = fielder_results_simple_random_3,
                                       result_4 = fielder_results_simple_random_4,
                                       result_5 = fielder_results_simple_random_5)

# Loop over the variables in var_hitter_list
for (j in 1:fielder_rep){
  
  for (i in 1:fielder_stat_num){
    # Run linear regression with grouped errors by country and robust errors
    base_vars_h  <- paste(control_vars, stat_fielder_t[[i + fielder_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_fielder_t_1[[i + fielder_stat_num*(j - 1)]],
                     sep = " + ")
    
    fielder_simple_random[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = starting_data,
                                                  model = "random",
                                                  index = c("id", "Anio_ref"))
        
    fielder_results_simple_random[[j]][[i]] <- coeftest(fielder_simple_random[[i + fielder_stat_num*(j - 1)]],
                                                         vcov = vcovHC(fielder_simple_random[[i + fielder_stat_num*(j - 1)]],
                                                                       type = "HC1",
                                                                       cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(fielder_results_simple_random[[j]],
          no.space = TRUE,
          type = "latex",
          title = "Lanzadores Iniciales: Efectos Aleatorios",
          covariate.labels = fielder_stats[[j]])
}
```

## First-Differences

Para aplicar las funciones hechas anteriormente obtendremos los rezagos de forma explícita y aplicaremos un OLS al panel resultante

```{r  hitter_stimation_simple_fd, echo=FALSE, eval=TRUE}
# Create a model to store the results
hitter_simple_fd <- list()

# To store the results
hitter_results_simple_fd_1 <- list()
hitter_results_simple_fd_2 <- list()
hitter_results_simple_fd_3 <- list()
hitter_results_simple_fd_4 <- list()
hitter_results_simple_fd <- list(result_1 = hitter_results_simple_fd_1,
                                  result_2 = hitter_results_simple_fd_2,
                                  result_3 = hitter_results_simple_fd_3,
                                  result_4 = hitter_results_simple_fd_4)

# Loop over the variables in var_hitter_list
for (j in 1:hitter_rep){
  
  for (i in 1:hitter_stat_num){
    # Run linear regression with first-differences
    base_vars_h  <- paste(control_vars, stat_hitter_t[[i + hitter_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_hitter_t_1[[i + hitter_stat_num*(j - 1)]],
                     sep = " + ")
    
    hitter_simple_fd[[i + hitter_stat_num*(j - 1)]] <- plm(formula, data = hitters_fd_panel,
                                                  model = "random",
                                                  index = c("id", "Anio_ref"))
        
    hitter_results_simple_fd[[j]][[i]] <- coeftest(hitter_simple_fd[[i + hitter_stat_num*(j - 1)]],
                                                        vcov = vcovHC(hitter_simple_fd[[i + hitter_stat_num*(j - 1)]],
                                                                      type = "HC1",
                                                                      cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(hitter_results_simple_fd[[j]],
          no.space = TRUE,
          type = "latex",
          title = "Bateadores: Primeras Diferencias",
          covariate.labels = hitter_stats[[j]])
}
```

```{r  filder_stimation_simple_fd, echo=FALSE, eval=TRUE}
# Create a model to store the results
fielder_simple_fd <- list()

# To store the results
fielder_results_simple_fd_1 <- list()
fielder_results_simple_fd_2 <- list()
fielder_results_simple_fd_3 <- list()
fielder_results_simple_fd_4 <- list()
fielder_results_simple_fd_5 <- list()
fielder_results_simple_fd <- list(result_1 = fielder_results_simple_fd_1,
                                  result_2 = fielder_results_simple_fd_2,
                                  result_3 = fielder_results_simple_fd_3,
                                  result_4 = fielder_results_simple_fd_4,
                                  result_4 = fielder_results_simple_fd_5)

# Loop over the variables in var_fielder_list
for (j in 1:fielder_rep){
  
  for (i in 1:fielder_stat_num){
    # Run linear regression with first-differences
    base_vars_h  <- paste(control_vars, stat_fielder_t[[i + fielder_stat_num*(j - 1)]],
                        sep = '+')
    formula <- paste(base_vars_h,
                     stat_fielder_t_1[[i + fielder_stat_num*(j - 1)]],
                     sep = " + ")
    
    fielder_simple_fd[[i + fielder_stat_num*(j - 1)]] <- plm(formula, data = fielders_fd_panel,
                                                  model = "random",
                                                  index = c("id", "Anio_ref"))
        
    fielder_results_simple_fd[[j]][[i]] <- coeftest(fielder_simple_fd[[i + fielder_stat_num*(j - 1)]],
                                                        vcov = vcovHC(fielder_simple_fd[[i + fielder_stat_num*(j - 1)]],
                                                                      type = "HC1",
                                                                      cluster = "group"))
  }
  
  # Print the third block of results
  stargazer(fielder_results_simple_fd[[j]],
          no.space = TRUE,
          type = "latex",
          title = "Fielders: Primeras Diferencias",
          covariate.labels = fielder_stats[[j]])
}
```


# Estimaciones conjuntas

Hasta el momento, solo hemos hecho el problema de identificación con distintos controles para el estimador del poder de negociación. Por lo tanto, ahora se hará la estimación con todos los controles significativos hasta que solo queden controles significativos en la estimación conjunta.

```{r hitter_stimation_1, echo=FALSE, eval=TRUE}
# Significant variables:
# Pooling:
hitter_vars_1 <- c("X_Home_runs",
                   "X_Home_runs_2")
# Add suffix "_t" to each name
stat_hitter_t <- paste0(hitter_vars_1, "_t")
stat_hitter_t_1 <- paste0(hitter_vars_1, "_t_1")
# Lista 
hitter_vars_1 <- c(paste(stat_hitter_t, collapse = " + "),
                   paste(stat_hitter_t_1, collapse = " + "))
# Within
hitter_vars_2 <- c("X_Bateos_promedio",
                   "X_Home_runs",
                   "X_Home_runs_2",
                   "X_Porcentaje_on_base",
                   "X_Porcentaje_on_base_2",
                   "X_Porcentaje_slugging")
# Add suffix "_t" to each name
stat_hitter_t <- paste0(hitter_vars_2, "_t")
stat_hitter_t_1 <- paste0(hitter_vars_2, "_t_1")
# Lista 
hitter_vars_2 <- c(paste(stat_hitter_t, collapse = " + "),
                   paste(stat_hitter_t_1, collapse = " + "))
# Random effects
hitter_vars_3 <- c("X_Home_runs",
                   "X_Home_runs_2")
# Add suffix "_t" to each name
stat_hitter_t <- paste0(hitter_vars_3, "_t")
stat_hitter_t_1 <- paste0(hitter_vars_3, "_t_1")
# Lista 
hitter_vars_3 <- c(paste(stat_hitter_t, collapse = " + "),
                   paste(stat_hitter_t_1, collapse = " + "))
# First Differences
hitter_vars_4 <- c("X_Home_runs",
                   "X_Home_runs_2",
                   "X_Porcentaje_On_base_plus_slugging_2",
                   "X_WAR",
                   "X_WAR_2")
# Add suffix "_t" to each name
stat_hitter_t <- paste0(hitter_vars_4, "_t")
stat_hitter_t_1 <- paste0(hitter_vars_4, "_t_1")
# Lista 
hitter_vars_4 <- c(paste(stat_hitter_t, collapse = " + "),
                   paste(stat_hitter_t_1, collapse = " + "))


# Pooling:
formula <- paste(control_vars,
                 hitter_vars_1[[1]],
                 sep = " + ")
formula <- paste(formula,
                 hitter_vars_1[[2]],
                 sep = " + ")
# Create a model to store the results
hitter_stimation_1 <- plm(formula, data = hitters_panel,
                          model = "pooling",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_1 <- coeftest(hitter_stimation_1,
                                       vcov = vcovHC(hitter_stimation_1,
                                                     type = "HC1",
                                                     cluster = "group"))
# Within:
formula <- paste(control_vars,
                 hitter_vars_2[[1]],
                 sep = " + ")
formula <- paste(formula,
                 hitter_vars_2[[2]],
                 sep = " + ")
# Create a model to store the results
hitter_stimation_2 <- plm(formula, data = hitters_panel,
                          model = "within",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_2 <- coeftest(hitter_stimation_2,
                                       vcov = vcovHC(hitter_stimation_2,
                                                     type = "HC1",
                                                     cluster = "group"))
# Random:
formula <- paste(control_vars,
                 hitter_vars_3[[1]],
                 sep = " + ")
formula <- paste(formula,
                 hitter_vars_3[[2]],
                 sep = " + ")
# Create a model to store the results
hitter_stimation_3 <- plm(formula, data = hitters_panel,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_3 <- coeftest(hitter_stimation_3,
                                       vcov = vcovHC(hitter_stimation_3,
                                                     type = "HC1",
                                                     cluster = "group"))
# First Differences:
formula <- paste(control_vars,
                 hitter_vars_4[[1]],
                 sep = " + ")
formula <- paste(formula,
                 hitter_vars_4[[2]],
                 sep = " + ")
# Create a model to store the results
hitter_stimation_4 <- plm(formula, data = hitters_fd_panel,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_4 <- coeftest(hitter_stimation_4,
                                       vcov = vcovHC(hitter_stimation_4,
                                                     type = "HC1",
                                                     cluster = "group"))

# Modelos
hitter_models <- list(pooling = hitter_results_stimation_1,
                      within = hitter_results_stimation_2,
                      random = hitter_results_stimation_3,
                      fd = hitter_results_stimation_4)


# Print the third block of results
stargazer(hitter_models,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Bateadores: Comparación de los modelos",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"))
```

```{r hitter_stimation_2, echo=FALSE, eval=TRUE}
# Significant variables:
# Pooling:
hitter_vars_1 <- c("X_Home_runs_2")
# Add suffix "_t" to each name
stat_hitter_t <- paste0(hitter_vars_1, "_t")
stat_hitter_t_1 <- paste0(hitter_vars_1, "_t_1")
# Lista 
hitter_vars_1 <- c(paste(stat_hitter_t, collapse = " + "),
                   paste(stat_hitter_t_1, collapse = " + "))
# Within
hitter_vars_2 <- c("X_Home_runs_2",
                   "X_Porcentaje_on_base")
# Add suffix "_t" to each name
stat_hitter_t <- paste0(hitter_vars_2, "_t")
stat_hitter_t_1 <- paste0(hitter_vars_2, "_t_1")
# Lista 
hitter_vars_2 <- c(paste(stat_hitter_t, collapse = " + "),
                   paste(stat_hitter_t_1, collapse = " + "))
# Random effects
hitter_vars_3 <- c("X_Home_runs",
                   "X_Home_runs_2")
# Add suffix "_t" to each name
stat_hitter_t <- paste0(hitter_vars_3, "_t")
stat_hitter_t_1 <- paste0(hitter_vars_3, "_t_1")
# Lista 
hitter_vars_3 <- c(paste(stat_hitter_t, collapse = " + "),
                   paste(stat_hitter_t_1, collapse = " + "))
# First Differences
hitter_vars_4 <- c("X_Home_runs_2",
                   "X_Porcentaje_On_base_plus_slugging_2",
                   "X_WAR")
# Add suffix "_t" to each name
stat_hitter_t <- paste0(hitter_vars_4, "_t")
stat_hitter_t_1 <- paste0(hitter_vars_4, "_t_1")
# Lista 
hitter_vars_4 <- c(paste(stat_hitter_t, collapse = " + "),
                   paste(stat_hitter_t_1, collapse = " + "))


# Pooling:
formula <- paste(control_vars,
                 hitter_vars_1[[1]],
                 sep = " + ")
formula <- paste(formula,
                 hitter_vars_1[[2]],
                 sep = " + ")
# Create a model to store the results
hitter_stimation_1 <- plm(formula, data = hitters_panel,
                          model = "pooling",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_1 <- coeftest(hitter_stimation_1,
                                       vcov = vcovHC(hitter_stimation_1,
                                                     type = "HC1",
                                                     cluster = "group"))
# Within:
formula <- paste(control_vars,
                 hitter_vars_2[[1]],
                 sep = " + ")
formula <- paste(formula,
                 hitter_vars_2[[2]],
                 sep = " + ")
# Create a model to store the results
hitter_stimation_2 <- plm(formula, data = hitters_panel,
                          model = "within",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_2 <- coeftest(hitter_stimation_2,
                                       vcov = vcovHC(hitter_stimation_2,
                                                     type = "HC1",
                                                     cluster = "group"))
# Random:
formula <- paste(control_vars,
                 hitter_vars_3[[1]],
                 sep = " + ")
formula <- paste(formula,
                 hitter_vars_3[[2]],
                 sep = " + ")
# Create a model to store the results
hitter_stimation_3 <- plm(formula, data = hitters_panel,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_3 <- coeftest(hitter_stimation_3,
                                       vcov = vcovHC(hitter_stimation_3,
                                                     type = "HC1",
                                                     cluster = "group"))
# First Differences:
formula <- paste(control_vars,
                 hitter_vars_4[[1]],
                 sep = " + ")
formula <- paste(formula,
                 hitter_vars_4[[2]],
                 sep = " + ")
# Create a model to store the results
hitter_stimation_4 <- plm(formula, data = hitters_fd_panel,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_4 <- coeftest(hitter_stimation_4,
                                       vcov = vcovHC(hitter_stimation_4,
                                                     type = "HC1",
                                                     cluster = "group"))

# Modelos
hitter_models <- list(pooling = hitter_results_stimation_1,
                      within = hitter_results_stimation_2,
                      random = hitter_results_stimation_3,
                      fd = hitter_results_stimation_4)


# Print the third block of results
stargazer(hitter_models,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Bateadores: Comparación de los modelos",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"))
```

```{r hitter_stimation_3, echo=FALSE, eval=TRUE}
# Significant variables:
# Pooling:
hitter_vars_1 <- c("X_Home_runs_2_t")
# Within
hitter_vars_2 <- c("X_Home_runs_2_t")
# Random effects
hitter_vars_3 <- c("X_Home_runs_2_t",
                   "X_Home_runs_t_1")
# First Differences
hitter_vars_4 <- c("X_Home_runs_2_t",
                   "X_Porcentaje_On_base_plus_slugging_2_t_1",
                   "X_WAR_t")


# Pooling:
formula <- paste(control_vars,
                 hitter_vars_1,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_1 <- plm(formula, data = hitters_panel,
                          model = "pooling",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_1 <- coeftest(hitter_stimation_1,
                                       vcov = vcovHC(hitter_stimation_1,
                                                     type = "HC1",
                                                     cluster = "group"))
# Within:
formula <- paste(control_vars,
                 hitter_vars_2,
                 sep = " + ")
# Create a model to store the results
hitter_stimation_2 <- plm(formula, data = hitters_panel,
                          model = "within",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_2 <- coeftest(hitter_stimation_2,
                                       vcov = vcovHC(hitter_stimation_2,
                                                     type = "HC1",
                                                     cluster = "group"))
# Random:
formula <- paste(control_vars,
                 hitter_vars_3[[1]],
                 sep = " + ")
formula <- paste(formula,
                 hitter_vars_3[[2]],
                 sep = " + ")
# Create a model to store the results
hitter_stimation_3 <- plm(formula, data = hitters_panel,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_3 <- coeftest(hitter_stimation_3,
                                       vcov = vcovHC(hitter_stimation_3,
                                                     type = "HC1",
                                                     cluster = "group"))
# First Differences:
formula <- paste(control_vars,
                 hitter_vars_4[[1]],
                 sep = " + ")
formula <- paste(formula,
                 hitter_vars_4[[2]],
                 sep = " + ")
# Create a model to store the results
hitter_stimation_4 <- plm(formula, data = hitters_fd_panel,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
hitter_results_stimation_4 <- coeftest(hitter_stimation_4,
                                       vcov = vcovHC(hitter_stimation_4,
                                                     type = "HC1",
                                                     cluster = "group"))

# Modelos
hitter_models <- list(pooling = hitter_results_stimation_1,
                      within = hitter_results_stimation_2,
                      random = hitter_results_stimation_3,
                      fd = hitter_results_stimation_4)
# Modelos
hitter_end_models <- list(pooling = hitter_stimation_1,
                      within = hitter_stimation_2,
                      random = hitter_stimation_3,
                      fd = hitter_stimation_4)


# Print the third block of results
stargazer(hitter_models,
         no.space = TRUE,
         align = TRUE,
         type = "latex",
         title = "Bateadores: Comparación de los modelos",
         column.labels = c("Pooling", "Within", 
                           "RE","FD"))
```


Aplicaremos un teest de Hausmann a cada pareja de modelos

```{r hausman_cojoint_hitter, echo=FALSE, eval=TRUE}
# create an empty list to store the test results
test_results_cojoint_hitter <- list()

# loop through every possible pair of models
for (i in 1:(length(hitter_end_models)-1)) {
  for (j in (i+1):length(hitter_end_models)) {
    # apply phtest to the pair of models
    test_result_cojoint_hitter <- phtest(hitter_end_models[[i]], hitter_end_models[[j]])
    # add the test result to the list
    test_results_cojoint_hitter[[paste0(names(hitter_end_models[i]), "_vs_", names(hitter_end_models[j]))]] <- test_result_cojoint_hitter
  }
}

# view the test results
test_results_cojoint_hitter
```

### Lanzadores Iniciales
```{r fielder_stimation_pooling_1, echo=FALSE, eval=TRUE}
# Significant variables:
fielder_vars_1 <- c('X_Control_2',
                    'X_Strike_outs_2')
# Add suffix "_t" to each name
stat_fielder_t <- paste0(fielder_vars_1, "_t")
stat_fielder_t_1 <- paste0(fielder_vars_1, "_t_1")
# Lista 
fielder_vars_1 <- c(paste(stat_fielder_t, collapse = " + "),
                   paste(stat_fielder_t_1, collapse = " + "))
# Within
fielder_vars_2 <- c('X_ERA_2',
                    'X_Strike_outs_2',
                    'X_Strike_outs',
                    'X_Strike_outs_2',
                    'X_WAR',
                    'X_WAR_2',
                    'X_Wins')
# Add suffix "_t" to each name
stat_fielder_t <- paste0(fielder_vars_2, "_t")
stat_fielder_t_1 <- paste0(fielder_vars_2, "_t_1")
# Lista 
fielder_vars_2 <- c(paste(stat_fielder_t, collapse = " + "),
                   paste(stat_fielder_t_1, collapse = " + "))
# Random effects
fielder_vars_3 <- c('X_Control_2',
                    'X_Strike_outs_2')
# Add suffix "_t" to each name
stat_fielder_t <- paste0(fielder_vars_3, "_t")
stat_fielder_t_1 <- paste0(fielder_vars_3, "_t_1")
# Lista 
fielder_vars_3 <- c(paste(stat_fielder_t, collapse = " + "),
                   paste(stat_fielder_t_1, collapse = " + "))
# First Differences
fielder_vars_4 <- c('X_Comando_2',
                    'X_Comando',
                    'X_Dominio',
                    'X_ERA_2',
                    'X_ERA',
                    'X_Inning_pitched',
                    'X_Losses_2')
# Add suffix "_t" to each name
stat_fielder_t <- paste0(fielder_vars_4, "_t")
stat_fielder_t_1 <- paste0(fielder_vars_4, "_t_1")
# Lista 
fielder_vars_4 <- c(paste(stat_fielder_t, collapse = " + "),
                   paste(stat_fielder_t_1, collapse = " + "))


# Pooling:
formula <- paste(control_vars,
                 fielder_vars_1[[1]],
                 sep = " + ")
formula <- paste(formula,
                 fielder_vars_1[[2]],
                 sep = " + ")
# Create a model to store the results
fielder_stimation_1 <- plm(formula, data = starting_data,
                          model = "pooling",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_1 <- coeftest(fielder_stimation_1,
                                       vcov = vcovHC(fielder_stimation_1,
                                                     type = "HC1",
                                                     cluster = "group"))
# Within:
formula <- paste(control_vars,
                 fielder_vars_2[[1]],
                 sep = " + ")
formula <- paste(formula,
                 fielder_vars_2[[2]],
                 sep = " + ")
# Create a model to store the results
fielder_stimation_2 <- plm(formula, data = starting_data,
                          model = "within",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_2 <- coeftest(fielder_stimation_2,
                                       vcov = vcovHC(fielder_stimation_2,
                                                     type = "HC1",
                                                     cluster = "group"))
# Random:
formula <- paste(control_vars,
                 fielder_vars_3[[1]],
                 sep = " + ")
formula <- paste(formula,
                 fielder_vars_3[[2]],
                 sep = " + ")
# Create a model to store the results
fielder_stimation_3 <- plm(formula, data = starting_data,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_3 <- coeftest(fielder_stimation_3,
                                       vcov = vcovHC(fielder_stimation_3,
                                                     type = "HC1",
                                                     cluster = "group"))
# First Differences:
formula <- paste(control_vars,
                 fielder_vars_4[[1]],
                 sep = " + ")
formula <- paste(formula,
                 fielder_vars_4[[2]],
                 sep = " + ")
# Create a model to store the results
fielder_stimation_4 <- plm(formula, data = fielders_fd_panel ,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_4 <- coeftest(fielder_stimation_4,
                                       vcov = vcovHC(fielder_stimation_4,
                                                     type = "HC1",
                                                     cluster = "group"))

# Models
fielder_models <- list(pooling = fielder_results_stimation_1,
                      within = fielder_results_stimation_2,
                      random = fielder_results_stimation_3,
                      fd = fielder_results_stimation_4)

# Print the third block of results
stargazer(fielder_models,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Lanzadores Iniciales: Comparación de los modelos",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"))
```

```{r fielder_stimation_pooling_ecom, echo=FALSE, eval=TRUE}
# Significant variables:
fielder_vars_1 <- c('X_Control_t',
                    'X_Strike_outs_2_t_1',
                    '-1')
# Lista 
fielder_vars_1 <- paste(fielder_vars_1, collapse = " + ")
# Within
fielder_vars_2 <- c('X_ERA_2_t_1')
# Lista 
fielder_vars_2 <- paste(fielder_vars_2, collapse = " + ")
# Random effects
fielder_vars_3 <- c('X_Control_t',
                    'X_Strike_outs_2_t_1',
                    '-1')
# Lista 
fielder_vars_3 <- paste(fielder_vars_3, collapse = " + ")
# First Differences
fielder_vars_4 <- c('X_Inning_pitched_t_1',
                    'X_Dominio_t',
                    'X_Losses_2_t_1')
# Lista 
fielder_vars_4 <- paste(fielder_vars_4, collapse = " + ")


# Pooling:
formula <- paste(control_vars,
                 fielder_vars_1,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_1 <- plm(formula, data = starting_data,
                          model = "pooling",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_1 <- coeftest(fielder_stimation_1,
                                       vcov = vcovHC(fielder_stimation_1,
                                                     type = "HC1",
                                                     cluster = "group"))
# Within:
formula <- paste(control_vars,
                 fielder_vars_2,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_2 <- plm(formula, data = starting_data,
                          model = "within",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_2 <- coeftest(fielder_stimation_2,
                                       vcov = vcovHC(fielder_stimation_2,
                                                     type = "HC1",
                                                     cluster = "group"))
# Random:
formula <- paste(control_vars,
                 fielder_vars_3,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_3 <- plm(formula, data = starting_data,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_3 <- coeftest(fielder_stimation_3,
                                       vcov = vcovHC(fielder_stimation_3,
                                                     type = "HC1",
                                                     cluster = "group"))
# First Differences:
formula <- paste(control_vars,
                 fielder_vars_4,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_4 <- plm(formula, data = fielders_fd_panel ,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_4 <- coeftest(fielder_stimation_4,
                                       vcov = vcovHC(fielder_stimation_4,
                                                     type = "HC1",
                                                     cluster = "group"))

# Modelos
fielder_models <- list(pooling = fielder_results_stimation_1,
                      within = fielder_results_stimation_2,
                      random = fielder_results_stimation_3,
                      fd = fielder_results_stimation_4)
# List to store models:
fielder_end_models <- list(pooling = fielder_stimation_1,
                            within = fielder_stimation_2,
                            random = fielder_stimation_3,
                            fd = fielder_stimation_4)

# Print the third block of results
stargazer(fielder_models,
         no.space = TRUE,
         align = TRUE,
         type = "text",
         title = "Lanzadores Iniciales: Comparación de los modelos - Segundo refinamiento",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"))
```

```{r fielder_stimation_pooling_ecom, echo=FALSE, eval=TRUE}
# Significant variables:
fielder_vars_1 <- c('X_Control_t',
                    '-1')
# Lista 
fielder_vars_1 <- paste(fielder_vars_1, collapse = " + ")
# Within
fielder_vars_2 <- c('X_ERA_2_t_1')
# Lista 
fielder_vars_2 <- paste(fielder_vars_2, collapse = " + ")
# Random effects
fielder_vars_3 <- c('X_Control_t',
                    '-1')
# Lista 
fielder_vars_3 <- paste(fielder_vars_3, collapse = " + ")
# First Differences
fielder_vars_4 <- c('X_Inning_pitched_t_1',
                    'X_Dominio_t',
                    'X_Losses_2_t_1')
# Lista 
fielder_vars_4 <- paste(fielder_vars_4, collapse = " + ")


# Pooling:
formula <- paste(control_vars,
                 fielder_vars_1,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_1 <- plm(formula, data = starting_data,
                          model = "pooling",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_1 <- coeftest(fielder_stimation_1,
                                       vcov = vcovHC(fielder_stimation_1,
                                                     type = "HC1",
                                                     cluster = "group"))
# Within:
formula <- paste(control_vars,
                 fielder_vars_2,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_2 <- plm(formula, data = starting_data,
                          model = "within",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_2 <- coeftest(fielder_stimation_2,
                                       vcov = vcovHC(fielder_stimation_2,
                                                     type = "HC1",
                                                     cluster = "group"))
# Random:
formula <- paste(control_vars,
                 fielder_vars_3,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_3 <- plm(formula, data = starting_data,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_3 <- coeftest(fielder_stimation_3,
                                       vcov = vcovHC(fielder_stimation_3,
                                                     type = "HC1",
                                                     cluster = "group"))
# First Differences:
formula <- paste(control_vars,
                 fielder_vars_4,
                 sep = " + ")
# Create a model to store the results
fielder_stimation_4 <- plm(formula, data = fielders_fd_panel ,
                          model = "random",
                          index = c("id", "Anio_ref"))
# To store the results
fielder_results_stimation_4 <- coeftest(fielder_stimation_4,
                                       vcov = vcovHC(fielder_stimation_4,
                                                     type = "HC1",
                                                     cluster = "group"))

# Modelos
fielder_models <- list(pooling = fielder_results_stimation_1,
                      within = fielder_results_stimation_2,
                      random = fielder_results_stimation_3,
                      fd = fielder_results_stimation_4)
# List to store models:
fielder_end_models <- list(pooling = fielder_stimation_1,
                            within = fielder_stimation_2,
                            random = fielder_stimation_3,
                            fd = fielder_stimation_4)

# Print the third block of results
stargazer(fielder_models,
         no.space = TRUE,
         align = TRUE,
         type = "latex",
         title = "Lanzadores Iniciales: Comparación de los modelos - Segundo refinamiento",
         column.labels = c("Pooling", "Within", 
                           "Random effects","First-Differences"))
```      
Aplicaremos un teest de Hausmann a cada pareja de modelos para los fildeadores

```{r hausman_cojoint_fielder, echo=FALSE, eval=TRUE}
# create an empty list to store the test results
test_results <- list()

# loop through every possible pair of models
for (i in 1:(length(fielder_end_models)-1)) {
  for (j in (i+1):length(fielder_end_models)) {
    # apply phtest to the pair of models
    test_result <- phtest(fielder_end_models[[i]], fielder_end_models[[j]])
    # add the test result to the list
    test_results[[paste0(names(fielder_end_models[i]), "_vs_", names(fielder_end_models[j]))]] <- test_result
  }
}

# view the test results
test_results
```

## Identificación simple

Debido al impacto de los ingresos del equipo en el poder de negociación es que haremos las estimaciones sin las medidas de desempeño o/ni controles.

### Sin controles

```{r control_hitter_result, echo=FALSE}
# Lista de bases de datos
data_list <- list(hitters_panel, hitters_panel, hitters_panel, hitters_fd_panel)

# Lista de modelos a aplicar
model_list <- list("pooling", "within", "random", "random")

# Lista de nombres para imprimri
name_list <- list("Pooling", "Within", "RE", "FD")

# Fórmula para el modelo
formula <- 'Y ~ Edad_t_2 + Anios_de_contrato_t_2 + I(team_num_t^2) + X_Ingresos_equipo_t + X_Ingresos_equipo_t_1 - 1'

# Inicializar una lista para almacenar los resultados
results_list <- list()

# Iterar sobre cada base de datos y cada modelo
for (i in 1:4) {
  # Estimar el modelo usando plm
  estimated_model <- plm(formula, data = data_list[[i]], model = model_list[[i]], index = c("id", "Anio_ref"))
  
  # Calcular errores estándar robustos
  robust_se <- coeftest(estimated_model, vcov = vcovHC(estimated_model, type = "HC1", cluster = "group"))

  # Almacenar los resultados
  results_list[[paste(name_list[[i]], model_list[[i]])]] <- robust_se
}

# Imprimir los resultados
for (i in 1:4) {
  stargazer(results_list[[i]],
                  no.space = TRUE,
                  type = "text",
                  title = paste("Bateadores:", name_list[[i]]),
                  covariate.labels = c("Edad$^{2}_{t}$", "Años de contrato$^{2}_{t}$",
                                       "Equipo$^{2}_{t}$",
                                       "X$_{tearev}_{t}$", "X$_{tearev}_{t-1}$"))
}
```

```{r control_filder_result, echo=FALSE}
# Lista de bases de datos
data_list <- list(fielders_panel, fielders_panel, fielders_panel, fielders_fd_panel)

# Lista de modelos a aplicar
model_list <- list("pooling", "within", "random", "random")

# Lista de nombres para imprimri
name_list <- list("Pooling", "Within", "RE", "FD")

# Fórmula para el modelo
formula <- 'Y ~ Edad_t_2 + Anios_de_contrato_t_2 + I(team_num_t^2) + X_Ingresos_equipo_t + X_Ingresos_equipo_t_1 - 1'

# Inicializar una lista para almacenar los resultados
results_list <- list()

# Iterar sobre cada base de datos y cada modelo
for (i in 1:4) {
  # Estimar el modelo usando plm
  estimated_model <- plm(formula, data = data_list[[i]], model = model_list[[i]], index = c("id", "Anio_ref"))
  
  # Calcular errores estándar robustos
  robust_se <- coeftest(estimated_model, vcov = vcovHC(estimated_model, type = "HC1", cluster = "group"))

  # Almacenar los resultados
  results_list[[paste(name_list[[i]], model)]] <- robust_se
}

# Imprimir los resultados
for (i in 1:4) {
  stargazer(results_list[[i]],
                  no.space = TRUE,
                  type = "latex",
                  title = paste("Fildeadores:", name_list[[i]]),
                  covariate.labels = c("Edad$^{2}_{t}$", "Años de contrato$^{2}_{t}$",
                                       "Equipo$^{2}_{t}$",
                                       "X$_{tearev}_{t}$", "X$_{tearev}_{t-1}$"))
}
```




```{r hausman_simple_hitter, echo=FALSE, eval=TRUE}
# Inicializar una lista para almacenar los modelos
hitter_simple_models <- list()

# Iterar sobre cada base de datos y cada modelo
for (i in 1:4) {
  # Estimar el modelo usando plm
  estimated_model <- plm(formula, data = data_list[[i]], model = model_list[[i]], index = c("id", "Anio_ref"))
  
  # Almacenar el modelo en la lista
  hitter_simple_models[[name_list[[i]]]] <- estimated_model
}

# Realizar el test de Hausman para cada par de modelos
hausman_results <- list()
for (i in 1:(length(hitter_simple_models) - 1)) {
  for (j in (i + 1):length(hitter_simple_models)) {
    # Realizar el test de Hausman entre el par de modelos
    test_result <- phtest(hitter_simple_models[[name_list[[i]]]], hitter_simple_models[[name_list[[j]]]])
    
    # Guardar el resultado en la lista
    pair_name <- paste(name_list[i], "vs", name_list[j])
    hausman_results[[pair_name]] <- test_result
  }
}

# Imprimir los resultados del test de Hausman
hausman_results
```

```{r hitter_correlation, echo=FALSE}
# Supongamos que tienes un dataframe llamado 'data'
# Lista de variables independientes
independent_vars <- c("var1", "var2", "var3") # Reemplaza con los nombres reales de tus variables

# Variable dependiente
dependent_var <- "Y" # Reemplaza con el nombre real de tu variable dependiente

# Función para calcular R^2 y el coeficiente de Pearson
calculate_stats <- function(data, independent_var, dependent_var) {
  # Calcula el coeficiente de correlación de Pearson
  pearson_correlation <- cor(data[[independent_var]], data[[dependent_var]], use = "complete.obs")
  
  # Ajusta un modelo lineal
  model <- lm(formula(paste(dependent_var, "~", independent_var)), data = data)
  
  # Calcula R^2
  r_squared <- summary(model)$r.squared
  
  # Retorna los resultados
  list(pearson_correlation = pearson_correlation, r_squared = r_squared)
}

# Aplicar la función a cada variable independiente y imprimir los resultados
for (var in independent_vars) {
  stats <- calculate_stats(data, var, dependent_var)
  print(paste("Variable independiente:", var))
  print(paste("Coeficiente de Correlación de Pearson:", stats$pearson_correlation))
  print(paste("Coeficiente R^2:", stats$r_squared))
  print("------")
}
```

## Identificación Simple

En este caso, solo haremos la identificación sin controles. Se irá refinando conforme la significancia de las variables.

```{r simple_identification_hitters_1, echo=FALSE}
# Inicializar una lista para almacenar los modelos
hitter_simple_models <- list()

# Lista de bases de datos
data_list <- list(hitters_panel, hitters_panel, hitters_panel, hitters_fd_panel)

# Lista de modelos a aplicar
model_list <- list("pooling", "within", "random", "random")

# Lista de nombres para imprimri
name_list <- list("Pooling", "Within", "RE", "FD")

# Fórmula para el modelo
formula <- 'Y ~ X_Ingresos_equipo_t + X_Ingresos_equipo_t_1 - 1'

# Inicializar una lista para almacenar los resultados
results_list <- list()

# Iterar sobre cada base de datos y cada modelo
for (i in 1:4) {
  # Estimar el modelo usando plm
  estimated_model <- plm(formula, data = data_list[[i]], model = model_list[[i]], index = c("id", "Anio_ref"))
  
  # Almacenar el modelo en la lista
  hitter_simple_models[[name_list[[i]]]] <- estimated_model
  
  # Calcular errores estándar robustos
  robust_se <- coeftest(estimated_model, vcov = vcovHC(estimated_model, type = "HC1", cluster = "group"))

  # Almacenar los resultados
  results_list[[paste(name_list[[i]], model_list[[i]])]] <- robust_se
}

# Imprimir los resultados
for (i in 1:4) {
  stargazer(results_list[[i]],
                  no.space = TRUE,
                  type = "text",
                  title = paste("Bateadores:", name_list[[i]]),
                  covariate.labels = c("X$_{tearev}_{t}$","X$_{tearev}_{t-1}$"))
}
```


Quitaremos la variable del periodo $t$

```{r simple_identification_hitters_2, echo=FALSE}
# Inicializar una lista para almacenar los modelos
hitter_simple_models <- list()

# Lista de bases de datos
data_list <- list(hitters_panel, hitters_panel, hitters_panel, hitters_fd_panel)

# Lista de modelos a aplicar
model_list <- list("pooling", "within", "random", "random")

# Lista de nombres para imprimri
name_list <- list("Pooling", "Within", "RE", "FD")

# Fórmula para el modelo
formula <- 'Y ~ X_Ingresos_equipo_t_1 - 1'

# Inicializar una lista para almacenar los resultados
results_list <- list()

# Iterar sobre cada base de datos y cada modelo
for (i in 1:4) {
  # Estimar el modelo usando plm
  estimated_model <- plm(formula, data = data_list[[i]], model = model_list[[i]], index = c("id", "Anio_ref"))
  
  # Almacenar el modelo en la lista
  hitter_simple_models[[name_list[[i]]]] <- estimated_model
  
  # Calcular errores estándar robustos
  robust_se <- coeftest(estimated_model, vcov = vcovHC(estimated_model, type = "HC1", cluster = "group"))

  # Almacenar los resultados
  results_list[[paste(name_list[[i]], model_list[[i]])]] <- robust_se
}

# Imprimir los resultados
for (i in 1:4) {
  stargazer(results_list[[i]],
                  no.space = TRUE,
                  type = "text",
                  title = paste("Bateadores:", name_list[[i]]),
                  covariate.labels = c("X$_{tearev}_{t-1}$"))
}
```

```{r simple_identification_fielders, echo=FALSE}
# Lista de bases de datos
data_list <- list(fielders_panel, fielders_panel, fielders_panel, fielders_fd_panel)

# Lista de modelos a aplicar
model_list <- list("pooling", "within", "random", "random")

# Lista de nombres para imprimri
name_list <- list("Pooling", "Within", "RE", "FD")

# Fórmula para el modelo
formula <- 'Y ~ X_Ingresos_equipo_t + X_Ingresos_equipo_t_1 - 1'

# Inicializar una lista para almacenar los resultados
results_list <- list()

# Iterar sobre cada base de datos y cada modelo
for (i in 1:4) {
  # Estimar el modelo usando plm
  estimated_model <- plm(formula, data = data_list[[i]], model = model_list[[i]], index = c("id", "Anio_ref"))
  
  # Calcular errores estándar robustos
  robust_se <- coeftest(estimated_model, vcov = vcovHC(estimated_model, type = "HC1", cluster = "group"))

  # Almacenar los resultados
  results_list[[paste(name_list[[i]], model_list[[i]])]] <- robust_se
}

# Imprimir los resultados
for (i in 1:4) {
  stargazer(results_list[[i]],
                  no.space = TRUE,
                  type = "text",
                  title = paste("Lanzadores Iniciales:", name_list[[i]]),
                  covariate.labels = c("X$_{tearev}_{t}$", "X$_{tearev}_{t-1}$"))
}
```
